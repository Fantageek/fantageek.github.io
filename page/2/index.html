
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>Fantageek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Khoa Pham">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Fantageek">
<meta property="og:url" content="http://www.fantageek.com/page/2/index.html">
<meta property="og:site_name" content="Fantageek">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fantageek">
<meta name="twitter:description">
<meta name="twitter:creator" content="@onmyway133">

    
    <link rel="alternative" href="/atom.xml" title="Fantageek" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Fantageek" title="Fantageek"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Fantageek">Fantageek</a></h1>
				<h2 class="blog-motto">Simple apps that make sense</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:www.fantageek.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/03/push-vs-pull-signal/" title="Push vs Pull Signal" itemprop="url">Push vs Pull Signal</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2016-01-03T02:21:36.000Z" itemprop="datePublished"> Published 2016-01-03</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>The idea of Signal may originate from <a href="http://elm-lang.org/guide/reactivity" target="_blank" rel="external">Elm Reactivity</a>, and it has now been widely adopted in iOS</p>
<p>I once asked <a href="http://stackoverflow.com/questions/29374792/what-are-examples-of-hot-and-cold-signal-in-reactivecocoa" target="_blank" rel="external">What are examples of hot and cold signal in ReactiveCocoa?</a></p>
<ul>
<li><a href="http://stackoverflow.com/questions/17082255/when-to-use-ienumerable-vs-iobservable" target="_blank" rel="external">When to use IEnumerable vs IObservable?</a></li>
<li><a href="Framework Overview">ReactiveCocoa Framework Overview</a></li>
<li><a href="http://blogs.microsoft.co.il/bnaya/2010/03/13/rx-for-beginners-part-9-hot-vs-cold-observable/" target="_blank" rel="external">Rx – for beginners (part 9): Hot Vs. Cold observable</a></li>
<li><a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/HotAndColdObservables.md" target="_blank" rel="external">RxSwift Hot and Cold Observables</a></li>
</ul>
<p>Whether it is hot vs cold, Signal vs Signal Producer, Observable vs Enumerable, … it’s good to understand how it gets implemented, so that to have a good sense of how they work</p>
<h2 id="Monad"><a href="#Monad" class="headerlink" title="Monad"></a>Monad</h2><ul>
<li><a href="http://www.fantageek.com/blog/2015/07/10/understanding-monad/">Understanding Monad</a></li>
</ul>
<p>Basically, Signal and its Result are just monads, which are thing that can be mapped and chained.</p>
<p>Signal makes use of deferred execution callback blocks, and <code>push vs pull</code> is just how the Signal updates its value and the order the callbacks are called</p>
<p>Execution callback block is that we pass a function to another function, and it will get called when appropriated</p>
<h2 id="Sync-vs-Async"><a href="#Sync-vs-Async" class="headerlink" title="Sync vs Async"></a>Sync vs Async</h2><p>Monad can be in either sync or async mode. Sync is easier to understand, but async is somewhat you’re already familiar and used in practice</p>
<p>Basically,</p>
<ul>
<li>Sync: you get the returned value right away via <code>return</code></li>
<li>Aync: you get the returned value via callback block</li>
</ul>
<p>Here is an example of a simple function</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// Sync</span><br><span class="line">func sum(a: Int, b: Int) -&gt; Int &#123;</span><br><span class="line">    return a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Async</span><br><span class="line">func sum(a: Int, b: Int, completion: Int -&gt; Void) &#123;</span><br><span class="line">    // Assumed it is a very long task to get the result</span><br><span class="line">    let result = a + b</span><br><span class="line"></span><br><span class="line">    completion(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here is an example of <code>Event</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// Sync</span><br><span class="line">public func map&lt;U&gt;(@noescape f: T -&gt; U) -&gt; Event&lt;U&gt; &#123;</span><br><span class="line">    switch self &#123;</span><br><span class="line">    case let .Next(value):</span><br><span class="line">        return .Next(value: f(value))</span><br><span class="line">    case let .Failed(error):</span><br><span class="line">        return .Failed(error: error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Async</span><br><span class="line">public func map&lt;U&gt;(f: (T, U -&gt; Void) -&gt; Void) -&gt; ((Event&lt;U&gt; -&gt; Void) -&gt; Void) &#123;</span><br><span class="line">        return &#123; g in   // g: Event&lt;U&gt; -&gt; Void</span><br><span class="line">            switch self &#123;</span><br><span class="line">            case let .Next(value):</span><br><span class="line">                f(value) &#123; transformedValue in  // transformedValue: U</span><br><span class="line">                    g(.Next(value: transformedValue))</span><br><span class="line">                &#125;</span><br><span class="line">            case let .Failed(error):</span><br><span class="line">                g(.Failed(error: error))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Push-Signal"><a href="#Push-Signal" class="headerlink" title="Push Signal"></a>Push Signal</h2><ul>
<li><a href="https://github.com/onmyway133/Signal/blob/master/Pod/Classes/Signal.swift" target="_blank" rel="external">Signal.swift</a></li>
<li><a href="https://www.youtube.com/watch?v=AcDaWe3S75c" target="_blank" rel="external">UIKonf 2015 - Jens Ravens: Functional Reactive Programming without Black Magic</a></li>
</ul>
<p>Take a look at my Push Signal, called <a href="https://github.com/onmyway133/Signal/blob/master/Pod/Classes/Signal.swift" target="_blank" rel="external">Signal</a>, it is like how <a href="https://github.com/onmyway133/Then/blob/master/Pod/Classes/Promise.swift" target="_blank" rel="external">Promise A+ Then</a> works</p>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public final class Signal&lt;T&gt; &#123;</span><br><span class="line">    var event: Event&lt;T&gt;?</span><br><span class="line">    var callbacks: [Event&lt;T&gt; -&gt; Void] = []</span><br><span class="line"></span><br><span class="line">    func notify() &#123;</span><br><span class="line">        guard let event = event else &#123;</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        callbacks.forEach &#123; callback in</span><br><span class="line">            callback(event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func update(event event: Event&lt;T&gt;) &#123;</span><br><span class="line">        dispatch_sync(lockQueue) &#123;</span><br><span class="line">            self.event = event</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        notify()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public func subscribe(f: Event&lt;T&gt; -&gt; Void) -&gt; Signal&lt;T&gt; &#123;</span><br><span class="line">        // Callback</span><br><span class="line">        if let event = event &#123;</span><br><span class="line">            f(event)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        callbacks.append(f)</span><br><span class="line"></span><br><span class="line">        return self</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public func map&lt;U&gt;(f: T -&gt; U) -&gt; Signal&lt;U&gt; &#123;</span><br><span class="line">        let signal = Signal&lt;U&gt;()</span><br><span class="line"></span><br><span class="line">        subscribe &#123; event in</span><br><span class="line">            signal.update(event: event.map(f))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return signal</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let signal = Signal&lt;String&gt;()</span><br><span class="line"></span><br><span class="line">signal.map &#123; value in</span><br><span class="line">        return value.characters.count</span><br><span class="line">    &#125;.subscribe &#123; event in</span><br><span class="line">        if case let .Next(value) = event &#123;</span><br><span class="line">            XCTAssert(value == 4)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            XCTAssert(false)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signal.sendNext(&quot;test&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="Callbacks"><a href="#Callbacks" class="headerlink" title="Callbacks"></a>Callbacks</h3><p>Given a chained signals like this</p>
<p>A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe)</p>
<ul>
<li>The idea is we send event to the source signal, and it propagates events through via callbacks.</li>
<li>Triggered by sending event to the source signal.</li>
<li>We must keep A as it keeps the others around</li>
<li>We subscribe the last D</li>
<li>We send event to the first A</li>
<li>A ‘s callback gets called, it it in turn calls callback of B with the result of A ‘s map, then B ‘s callback calls C ‘s callback with the result of B<br>‘s flatMap, …</li>
</ul>
<h2 id="Pull-Signal"><a href="#Pull-Signal" class="headerlink" title="Pull Signal"></a>Pull Signal</h2><ul>
<li><a href="https://github.com/onmyway133/Signal/blob/master/Pod/Classes/Future.swift" target="_blank" rel="external">Future.swift</a></li>
<li><a href="https://www.youtube.com/watch?v=mbd6g7NfR-8" target="_blank" rel="external">Swift Sync and Async Error Handling - iOS Conf SG 2015</a></li>
</ul>
<p>Take a look at my Pull Signal, called <a href="https://github.com/onmyway133/Signal/blob/master/Pod/Classes/Future.swift" target="_blank" rel="external">Future</a></p>
<h3 id="Implementation-1"><a href="#Implementation-1" class="headerlink" title="Implementation"></a>Implementation</h3><p>Here <code>operation</code> is a task, when called and completed, will notify its <code>completion</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public struct Future&lt;T&gt; &#123;</span><br><span class="line">    let operation: (Event&lt;T&gt; -&gt; Void) -&gt; Void</span><br><span class="line"></span><br><span class="line">    public init(operation: (Event&lt;T&gt; -&gt; Void) -&gt; Void) &#123;</span><br><span class="line">        self.operation = operation</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public func start(completion: Event&lt;T&gt; -&gt; Void) &#123;</span><br><span class="line">        operation() &#123; event in</span><br><span class="line">            completion(event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public func map&lt;U&gt;(f: T -&gt; U) -&gt; Future&lt;U&gt; &#123;</span><br><span class="line">        return Future&lt;U&gt; &#123; completion in</span><br><span class="line">            self.start &#123; event in</span><br><span class="line">                completion(event.map(f))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Usage-1"><a href="#Usage-1" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let _ = Future&lt;String&gt; &#123; completion in</span><br><span class="line">        // There is some work here</span><br><span class="line">        completion(Event(value: &quot;test&quot;))</span><br><span class="line">    &#125;</span><br><span class="line">    .map &#123; value in</span><br><span class="line">        value.characters.count</span><br><span class="line">    &#125;.start &#123; event in</span><br><span class="line">        if case let .Next(value) = event &#123;</span><br><span class="line">            XCTAssert(value == 4)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            XCTAssert(false)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Callbacks-1"><a href="#Callbacks-1" class="headerlink" title="Callbacks"></a>Callbacks</h3><p>Given a chained signals like this</p>
<p>A -(map)-&gt; B -(flatMap)-&gt; C -(flatMap)-&gt; D -(subscribe)</p>
<ul>
<li>The idea is we subscribe to the final signal D, and it cause the previous signals to action.</li>
<li>Triggered by subscribing to the final signal.</li>
<li>We must keep D as it keeps the others around</li>
<li>We subscribe the last D</li>
<li>D ‘s operation actions, and it cause C ‘s operation to action, … then A ‘s operation actions. It is in A that the task is performed (like fetching network, retrieving database, file access, heavy computation, …) to get the result, and A ‘s completion gets called. Then A’s completion calls B ‘s completion with the result mapped by B ‘s map, … all the way to the subscriber ‘s completion block</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/03/push-vs-pull-signal/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/02/curry-in-swift/" title="Curry in Swift" itemprop="url">Curry in Swift</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2016-01-02T03:58:39.000Z" itemprop="datePublished"> Published 2016-01-02</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Haskell is notorious for <code>currying</code>, and Swift has currying, too</p>
<p>I love ReactiveCocoa, RxSwift and I always take time to dig into it. The other day, I was practise making Signal based on this talk <a href="https://www.youtube.com/watch?v=AcDaWe3S75c" target="_blank" rel="external">UIKonf 2015 - Jens Ravens: Functional Reactive Programming without Black Magic</a></p>
<p>Take a look at my repo <a href="https://github.com/onmyway133/Signal" target="_blank" rel="external">Signal</a></p>
<h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><p>I was making a filter for a <code>Signal</code>. The idea of filter is that we should update signal if the Event is Next with right filtered value</p>
<p><code>Signal.swift</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt;&#123;</span><br><span class="line">    let signal = Signal&lt;T&gt;()</span><br><span class="line">    subscribe &#123; result in</span><br><span class="line">        switch(result) &#123;</span><br><span class="line">        case let .Success(value):</span><br><span class="line">            if f(value) &#123;</span><br><span class="line">                signal.update(result)</span><br><span class="line">            &#125;</span><br><span class="line">        case let .Error(error): signal.update(.Error(error))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return signal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-params"><a href="#2-params" class="headerlink" title="2 params"></a>2 params</h2><p>But having <code>Event</code> as another monad, I think it should be more encapsulated if that switching logic gets moved into the <code>Event</code>. Here the filter takes 2 params</p>
<p><code>Event.swift</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func filter(f: T -&gt; Bool, callback: (Event&lt;T&gt; -&gt; Void)) &#123;</span><br><span class="line">        switch self &#123;</span><br><span class="line">        case let .Next(value) where f(value):</span><br><span class="line">            callback(self)</span><br><span class="line">        case .Failed:</span><br><span class="line">            callback(self)</span><br><span class="line">        default:</span><br><span class="line">            break</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>Signal.swift</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; &#123;</span><br><span class="line">    let signal = Signal&lt;T&gt;()</span><br><span class="line"></span><br><span class="line">    subscribe &#123; event in</span><br><span class="line">        event.filter(f, callback: signal.update)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return signal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Currying"><a href="#Currying" class="headerlink" title="Currying"></a>Currying</h2><p>With currying, we can make <code>filter</code> a more abstract function, and defer the decision to pass the <code>callback</code> param. It is a little carried away but I find it helpful this way</p>
<p>Now <code>filter</code> accepts 1 param, and it returns a function that takes <code>callback</code> as its param</p>
<p><code>Event.swift</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">func filter(f: T -&gt; Bool) -&gt; ((Event&lt;T&gt; -&gt; Void) -&gt; Void) &#123;</span><br><span class="line">        return &#123; g in</span><br><span class="line">            switch self &#123;</span><br><span class="line">            case let .Next(value) where f(value):</span><br><span class="line">                g(self)</span><br><span class="line">            case .Failed:</span><br><span class="line">                g(self)</span><br><span class="line">            default:</span><br><span class="line">                break</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p><code>Signal.swift</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public func filter(f: T -&gt; Bool) -&gt; Signal&lt;T&gt; &#123;</span><br><span class="line">        let signal = Signal&lt;T&gt;()</span><br><span class="line"></span><br><span class="line">        subscribe &#123; event in</span><br><span class="line">            event.filter(f)(signal.update)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return signal</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Curry-syntax-in-Swift-2"><a href="#Curry-syntax-in-Swift-2" class="headerlink" title="Curry syntax in Swift 2"></a>Curry syntax in Swift 2</h2><p>Swift 2 supports curry syntax function</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(a: Int)</span></span>(b: <span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sumWith5 = sum(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">let</span> result = sumWith5(b: <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h2 id="No-more-curry-syntax-in-Swift-3"><a href="#No-more-curry-syntax-in-Swift-3" class="headerlink" title="No more curry syntax in Swift 3"></a>No more curry syntax in Swift 3</h2><p>You may want to find out</p>
<ul>
<li><a href="http://ericasadun.com/2015/12/18/bidding-farewell-to-currying/" target="_blank" rel="external">Bidding farewell to currying</a></li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://learnyouahaskell.com/higher-order-functions" target="_blank" rel="external">Higher order functions</a></li>
<li><a href="http://programmers.stackexchange.com/questions/185585/what-is-the-advantage-of-currying" target="_blank" rel="external">What is the advantage of currying?</a></li>
<li><a href="http://stackoverflow.com/questions/4888480/practical-use-of-curried-functions?lq=1" target="_blank" rel="external">Practical use of curried functions?</a></li>
<li><a href="https://robots.thoughtbot.com/introduction-to-function-currying-in-swift" target="_blank" rel="external">Introduction to Function Currying in Swift</a></li>
<li><a href="http://www.russbishop.net/swift-function-currying" target="_blank" rel="external">Swift Function Currying</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/02/curry-in-swift/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/27/nsnotificationcenter-in-ios/" title="NSNotificationCenter in iOS" itemprop="url">NSNotificationCenter in iOS</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-27T09:42:17.000Z" itemprop="datePublished"> Published 2015-12-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><code>NSNotificationCenter</code> is like central hub where notifications are posted and received by any parts of the app</p>
<h2 id="Registering"><a href="#Registering" class="headerlink" title="Registering"></a>Registering</h2><p>Registering for notification n times, you get notified n times</p>
<h2 id="debugDescription"><a href="#debugDescription" class="headerlink" title="debugDescription"></a>debugDescription</h2><p>As of iOS 9+,</p>
<blockquote>
<p>NSNotificationCenter and NSDistributedNotificationCenter will now provide a debug description when printing from the debugger that will list all registered observers including references that have been zeroed out for aiding in debugging notification registrations. This data is only valid per the duration of the breakpoint since the underlying store must account for multithreaded environments. Wildcard registrations for notifications where the name or object that was passed to the addObserver method family was null will be printed in the debug description as *.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="type">NSNotificationCenter</span>.defaultCenter().debugDescription)</span><br></pre></td></tr></table></figure>
<h2 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h2><h3 id="addObserver-selector-name-object"><a href="#addObserver-selector-name-object" class="headerlink" title="addObserver(_:selector:name:object:)"></a>addObserver(_:selector:name:object:)</h3><blockquote>
<p>Adds an entry to the receiver’s dispatch table with an observer, a notification selector and optional criteria: notification name and sender.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line"></span><br><span class="line">    <span class="type">NSNotificationCenter</span>.defaultCenter().addObserver(<span class="keyword">self</span>, selector: <span class="string">"playerDidReachEndNotificationHandler:"</span>, name: <span class="type">AVPlayerItemDidPlayToEndTimeNotification</span>, object: player.currentItem)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">playerDidReachEndNotificationHandler</span><span class="params">(notification: NSNotification)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> playerItem = notification.object <span class="keyword">as</span>? <span class="type">AVPlayerItem</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">    playerItem.seekToTime(kCMTimeZero)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>NSNotificationCenter holds weak reference to its observer</li>
<li>Regular notification centers deliver notifications on the thread in which the notification was posted</li>
</ul>
<h3 id="addObserverForName-object-queue-usingBlock"><a href="#addObserverForName-object-queue-usingBlock" class="headerlink" title="addObserverForName(_:object:queue:usingBlock:)"></a>addObserverForName(_:object:queue:usingBlock:)</h3><blockquote>
<p>Adds an entry to the receiver’s dispatch table with a notification queue and a block to add to the queue, and optional criteria: notification name and sender.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">observer = <span class="type">NSNotificationCenter</span>.defaultCenter().addObserverForName(<span class="type">AVPlayerItemDidPlayToEndTimeNotification</span>, object: player.currentItem, queue: <span class="type">NSOperationQueue</span>.mainQueue()) &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] notification <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">self</span>?.playerDidReachEndNotificationHandler(notification)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>The returned of this method is an opaque object to act as the observer, and <code>NSNotificationCenter</code> holds a strong reference to this object</li>
<li>Avoid strongly capturing objects in the block. See <a href="http://sealedabstract.com/code/nsnotificationcenter-with-blocks-considered-harmful/" target="_blank" rel="external">NSNotificationCenter with blocks considered harmful</a></li>
</ul>
<h2 id="When-to-unregister"><a href="#When-to-unregister" class="headerlink" title="When to unregister ?"></a>When to unregister ?</h2><p>The idea is to unregister as soon as we don’t need to receive notifications. Most of the time, it is our <code>deinit</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">deinit</span> &#123;</span><br><span class="line">    <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(<span class="keyword">self</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>See <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Notifications/Articles/Registering.html#//apple_ref/doc/uid/20000723-CEGCCFID" target="_blank" rel="external">Unregistering an Observer</a></p>
<blockquote>
<p>Before an object that is observing notifications is deallocated, it must tell the notification center to stop sending it notifications. Otherwise, the next notification gets sent to a nonexistent object and the program crashes</p>
</blockquote>
<h3 id="iOS-9"><a href="#iOS-9" class="headerlink" title="iOS 9+"></a>iOS 9+</h3><p>See <a href="https://developer.apple.com/library/mac/releasenotes/Foundation/RN-Foundation/index.html#10_11NotificationCenter" target="_blank" rel="external">OS X 10.11 and iOS 9 Release Notes<br>Cocoa Foundation Framework</a></p>
<blockquote>
<p>In OS X 10.11 and iOS 9.0 NSNotificationCenter and NSDistributedNotificationCenter will no longer send notifications to registered observers that may be deallocated</p>
<p>This means that observers are not required to un-register in their deallocation method</p>
</blockquote>
<p>However,</p>
<blockquote>
<p>Block based observers via the -[NSNotificationCenter addObserverForName:object:queue:usingBlock] method still need to be un-registered when no longer in use since the system still holds a strong reference to these observers</p>
</blockquote>
<p>So we must call <code>removeObserver</code> on the returned <code>observer</code> object<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">deinit</span> &#123;</span><br><span class="line">    <span class="type">NSNotificationCenter</span>.defaultCenter().removeObserver(observer)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Synchrony"><a href="#Synchrony" class="headerlink" title="Synchrony"></a>Synchrony</h2><blockquote>
<p>A notification center delivers notifications to observers synchronously. In other words, when posting a notification, control does not return to the poster until all observers have received and processed the notification</p>
</blockquote>
<p>If you have performance problem of posting notifications to large number of observers, consider using</p>
<ul>
<li>dispatch_after</li>
<li>Many <code>NSNotificationCenter</code></li>
<li><code>NSNotificationQueue</code></li>
</ul>
<h2 id="NSNotificationQueue"><a href="#NSNotificationQueue" class="headerlink" title="NSNotificationQueue"></a>NSNotificationQueue</h2><ul>
<li>Enqueuing methods return immediately</li>
<li>Associated with the run loop modes</li>
<li>There ‘s <code>defaultQueue</code> for the current thread</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> queue = <span class="type">NSNotificationQueue</span>(notificationCenter: <span class="type">NSNotificationCenter</span>.defaultCenter())</span><br><span class="line">    <span class="keyword">let</span> notification = <span class="type">NSNotification</span>(name: <span class="string">"CacheDidUpdateNotification"</span>, object: <span class="keyword">self</span>)</span><br><span class="line">    queue.enqueueNotification(notification, postingStyle: .<span class="type">PostASAP</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Notifications/Introduction/introNotifications.html#//apple_ref/doc/uid/10000043-SW1" target="_blank" rel="external">Notification Programming Topics</a></li>
<li><a href="http://sealedabstract.com/code/nsnotificationcenter-with-blocks-considered-harmful/" target="_blank" rel="external">NSNotificationCenter with blocks considered harmful</a></li>
<li><a href="http://useyourloaf.com/blog/delegation-or-notification.html" target="_blank" rel="external">Delegation or Notification</a></li>
<li><a href="https://mikeash.com/pyblog/friday-qa-2010-01-08-nsnotificationqueue.html" target="_blank" rel="external">Friday Q&amp;A 2010-01-08: NSNotificationQueue</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/27/nsnotificationcenter-in-ios/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/20/xmas/" title="Xmas" itemprop="url">Xmas</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-20T03:23:58.000Z" itemprop="datePublished"> Published 2015-12-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Christmas is when we I have the most special feeling. The cool air, the snow, the reunion, the church bell ringing, …</p>
<p><img src="http://www.fantageek.com/images/christmas_scene.jpg" alt=""><br>(From google)</p>
<p>It ‘s beginning to look a lot like Christmas. First with Xcode</p>
<h2 id="Xmas"><a href="#Xmas" class="headerlink" title="Xmas"></a>Xmas</h2><p><a href="https://github.com/onmyway133/xmas" target="_blank" rel="external">Xmas</a> is an Xcode plugin that shows Xmas picture along with wishing message whenever a build succeeds</p>
<p><img src="https://github.com/onmyway133/Xmas/raw/master/Screenshots/xmas.png" alt=""></p>
<h2 id="How-it-works"><a href="#How-it-works" class="headerlink" title="How it works"></a>How it works</h2><h3 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h3><ul>
<li>Try to do much of the job in Swift as possible</li>
</ul>
<h3 id="DVTKit"><a href="#DVTKit" class="headerlink" title="DVTKit"></a>DVTKit</h3><ul>
<li>Xcode uses <code>DVTBezelAlertPanel</code> to display alert. So we swizzle its <code>initWithIcon:message:parentWindow:duration:</code></li>
<li><code>DVTBezelAlertPanel</code> is from <code>DVTKit</code>. I thought about importing <a href="https://github.com/luisobo/Xcode-RuntimeHeaders" target="_blank" rel="external">run time header</a> and just <code>extension</code> it. But I find swizzling in Objective C a much more easier solution</li>
</ul>
<h3 id="NSVisualEffectView"><a href="#NSVisualEffectView" class="headerlink" title="NSVisualEffectView"></a>NSVisualEffectView</h3><ul>
<li>It seems that <code>NSImage</code> added to the panel ‘s <code>NSVisualEffectView</code> had it <code>template</code> set to YES again, hence causing the image into template color with the panel background color</li>
<li>This happens in the <code>init</code> method. So we must change <code>template</code> back to NO after <code>init</code> happens</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)xmas_initWithIcon:(<span class="keyword">id</span>)icon</span><br><span class="line">                message:(<span class="built_in">NSString</span> *)message</span><br><span class="line">           parentWindow:(<span class="keyword">id</span>)parentWindow</span><br><span class="line">               duration:(<span class="keyword">double</span>)duration &#123;</span><br><span class="line">        [<span class="keyword">self</span> xmas_initWithIcon:image message:gift.message parentWindow:parentWindow duration:duration];</span><br><span class="line"></span><br><span class="line">        image.template = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And, Merry Christmas to you and your family</p>
<iframe width="854" height="480" src="https://www.youtube.com/embed/yrRPLBYiiEc" frameborder="0" allowfullscreen></iframe>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://www.raywenderlich.com/94020/creating-an-xcode-plugin-part-1" target="_blank" rel="external">How To Create an Xcode Plugin: Part 1/3</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/20/xmas/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/18/a-simple-resolver-for-swift/" title="A simple resolver for Swift" itemprop="url">A simple resolver for Swift</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-18T05:06:07.000Z" itemprop="datePublished"> Published 2015-12-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="The-Marvel-world"><a href="#The-Marvel-world" class="headerlink" title="The Marvel world"></a>The Marvel world</h2><h3 id="Ant-Man"><a href="#Ant-Man" class="headerlink" title="Ant Man"></a>Ant Man</h3><p>We know Ant Man is Hank Pym</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AntManSuit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HankPym</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> suit = <span class="type">AntManSuit</span>(name: <span class="string">"Ant Man ID #101"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fight</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Fighting with the suit named "</span> + suit.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> hankPym = <span class="type">HankPym</span>()</span><br><span class="line">hankPym.fight()</span><br></pre></td></tr></table></figure>
<p>Everytime HankPym is created, he always uses the Ant Man suit. This time he is so coupled to the role Ant Man</p>
<h3 id="More-suits"><a href="#More-suits" class="headerlink" title="More suits"></a>More suits</h3><p>Well, he does not have to be too dependent on the Ant Man suit. We know Hank Pym is a genius scientist, he has more suits to use. Let’s make it decoupled</p>
<p>Using Dependency Injection</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Suit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AntManSuit</span>: <span class="title">Suit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">YellowJacketSuit</span>: <span class="title">Suit</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HankPym</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> suit: <span class="type">Suit</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">fight</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Fighting with the suit named "</span> + suit.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> suit = <span class="type">YellowJacketSuit</span>(name: <span class="string">"Yellow Jacket ID #33"</span>)</span><br><span class="line"><span class="keyword">let</span> hankPym = <span class="type">HankPym</span>(suit: suit)</span><br><span class="line">hankPym.fight()</span><br></pre></td></tr></table></figure>
<p>Now Hank Pym can be more flexible on which suit to use.</p>
<h2 id="Dependency-Injection"><a href="#Dependency-Injection" class="headerlink" title="Dependency Injection"></a>Dependency Injection</h2><p>The technique we just saw is called <code>Dependency Injection</code>, in which Hank Pym does not need to create the Suit, it will be provided through constructor or property.</p>
<h2 id="Dependency-Inversion-Principle"><a href="#Dependency-Inversion-Principle" class="headerlink" title="Dependency Inversion Principle"></a>Dependency Inversion Principle</h2><p>In the first example, Hank Pym is dependent on the concrete implementation of the Suit</p>
<p>In the second example, both Hank Pym and the suits are dependent on the Suit protocol. This way Hank Pym only knows about the Suit protocol, and future suits must be crafted to that it conforms to the Suit protocol</p>
<p>This way the dependency is inverted</p>
<blockquote>
<p>High level modules should not depend upon low level modules. Both should depend upon abstractions.</p>
<p>What is the high level policy? It is the abstractions that underlie the application, the<br>truths that do not vary when the details are changed</p>
</blockquote>
<h2 id="Inversion-of-Control-Container"><a href="#Inversion-of-Control-Container" class="headerlink" title="Inversion of Control Container"></a>Inversion of Control Container</h2><p>You may ask yourself <a href="http://programmers.stackexchange.com/questions/205681/why-is-inversion-of-control-named-that-way" target="_blank" rel="external">Why is Inversion of Control named that way?</a></p>
<h3 id="Framework-vs-library"><a href="#Framework-vs-library" class="headerlink" title="Framework vs library"></a>Framework vs library</h3><p>People said “the framework calls you but you call the library”</p>
<h3 id="Command-line-vs-GUI"><a href="#Command-line-vs-GUI" class="headerlink" title="Command line vs GUI"></a>Command line vs GUI</h3><p>See <a href="http://stackoverflow.com/a/3108/1418457" target="_blank" rel="external">What is Inversion of Control?</a></p>
<p>For example, in an old school menu, you might have:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print &quot;enter your name&quot;</span><br><span class="line">read name</span><br><span class="line">print &quot;enter your address&quot;</span><br><span class="line">read address</span><br><span class="line">etc...</span><br><span class="line">store in database</span><br></pre></td></tr></table></figure>
<p>thereby controlling the flow of user interaction.</p>
<p>In a GUI program or some such, instead we say</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">when the user types in field a, store it in NAME</span><br><span class="line">when the user types in field b, store it in ADDRESS</span><br><span class="line">when the user clicks the save button, call StoreInDatabase</span><br></pre></td></tr></table></figure>
<p>You how have a brief understanding of how IoC means</p>
<h3 id="IoC-container"><a href="#IoC-container" class="headerlink" title="IoC container"></a>IoC container</h3><p>In the 2nd example of the Suit protocol, you can see how there is a inversion of control. What if there is a container that contains all the Suit conformances?</p>
<p>Let’s use my <a href="https://github.com/onmyway133/Resolver" target="_blank" rel="external">Resolver</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> resolver = <span class="type">Resolver</span>()</span><br><span class="line">resolver.register &#123;</span><br><span class="line">    <span class="type">YellowJacketSuit</span>(name: <span class="string">"YellowJacket ID #404"</span>) <span class="keyword">as</span> <span class="type">Suit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> suit = <span class="keyword">try</span>! resolver.resolve() <span class="keyword">as</span> <span class="type">Suit</span></span><br><span class="line"><span class="keyword">let</span> hankPym = <span class="type">HankPym</span>(suit: suit)</span><br></pre></td></tr></table></figure>
<p>Quite helpful, right? :]</p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>Actually, IoC container helps you more than that.</p>
<ul>
<li>Circular Dependency Injection</li>
<li>Auto Injection</li>
<li>Object Scope</li>
<li>…</li>
</ul>
<p>There are some IoC containers in Swift</p>
<h3 id="Swinject"><a href="#Swinject" class="headerlink" title="Swinject"></a><a href="https://github.com/Swinject/Swinject" target="_blank" rel="external">Swinject</a></h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> container = <span class="type">Container</span>()</span><br><span class="line">container.register(<span class="type">AnimalType</span>.<span class="keyword">self</span>) &#123; <span class="number">_</span> <span class="keyword">in</span> <span class="type">Cat</span>(name: <span class="string">"Mimi"</span>) &#125;</span><br><span class="line">container.register(<span class="type">PersonType</span>.<span class="keyword">self</span>) &#123; r <span class="keyword">in</span></span><br><span class="line">     <span class="type">PetOwner</span>(pet: r.resolve(<span class="type">AnimalType</span>.<span class="keyword">self</span>)!)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Swinject requires explicit type declaration. It has SwinjectStoryboard, which helps configuring the dependency for your view controller</p>
<h3 id="Dip"><a href="#Dip" class="headerlink" title="Dip"></a><a href="https://github.com/AliSoftware/Dip" target="_blank" rel="external">Dip</a></h3><p>Dip leverages generic and encourage protocols</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">container.register &#123; <span class="type">ServiceImp</span>() <span class="keyword">as</span> <span class="type">Service</span> &#125;</span><br><span class="line"><span class="keyword">let</span> service = <span class="keyword">try</span>! container.resolve() <span class="keyword">as</span> <span class="type">Service</span></span><br></pre></td></tr></table></figure>
<p>You ‘ll learn a lot just by reading Dip source code, on how factory and factory type are stored and checked using generic</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">resolve</span>&lt;T, F&gt;<span class="params">(tag tag: Tag? = <span class="literal">nil</span>, builder: F-&gt;T)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> key = <span class="type">DefinitionKey</span>(protocolType: <span class="type">T</span>.<span class="keyword">self</span>, factoryType: <span class="type">F</span>.<span class="keyword">self</span>, associatedTag: tag)</span><br><span class="line">    <span class="keyword">let</span> nilTagKey = tag.<span class="built_in">map</span> &#123; <span class="number">_</span> <span class="keyword">in</span> <span class="type">DefinitionKey</span>(protocolType: <span class="type">T</span>.<span class="keyword">self</span>, factoryType: <span class="type">F</span>.<span class="keyword">self</span>, associatedTag: <span class="literal">nil</span>) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> definition = (<span class="keyword">self</span>.definitions[key] ?? <span class="keyword">self</span>.definitions[nilTagKey]) <span class="keyword">as</span>? <span class="type">DefinitionOf</span>&lt;<span class="type">T</span>, <span class="type">F</span>&gt; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="type">DipError</span>.<span class="type">DefinitionNotFound</span>(key)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> usingKey: <span class="type">DefinitionKey</span>? = definition.scope == .<span class="type">ObjectGraph</span> ? key : <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">return</span> _resolve(tag, key: usingKey, definition: definition, builder: builder)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Build-your-own-simple-IoC-container"><a href="#Build-your-own-simple-IoC-container" class="headerlink" title="Build your own simple IoC container"></a>Build your own simple IoC container</h2><p>You may have discovered, that the idea of all those framework is to use closure as factory method</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> factory = &#123;</span><br><span class="line">    <span class="type">YellowJacketSuit</span>(name: <span class="string">"YellowJacket ID #007"</span>) <span class="keyword">as</span> <span class="type">Suit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> suit = factory()</span><br></pre></td></tr></table></figure>
<p>All we have to do is to store these factories closure</p>
<p>Take a look at my gist <a href="https://gist.github.com/onmyway133/3244cde1eaf8f2cd2ecb" target="_blank" rel="external">SimpleResolver.swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleResolver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> factories = [<span class="type">String</span>: <span class="type">Any</span>]()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">factory</span>&lt;T&gt;<span class="params">(factory: <span class="params">()</span></span></span> -&gt; <span class="type">T</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> key = <span class="type">String</span>(<span class="type">T</span>.<span class="keyword">self</span>)</span><br><span class="line">        factories[key] = factory</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">resolve</span>&lt;T&gt;<span class="params">()</span></span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> key = <span class="type">String</span>(<span class="type">T</span>.<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> factory = factories[key] <span class="keyword">as</span>? () -&gt; <span class="type">T</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> factory()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>(<span class="string">"Registration not found"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> resolver = <span class="type">SimpleResolver</span>()</span><br><span class="line"></span><br><span class="line">resolver.factory &#123;</span><br><span class="line">    <span class="type">YellowJacketSuit</span>(name: <span class="string">"YellowJacket IS #009"</span>) <span class="keyword">as</span> <span class="type">Suit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> suit = resolver.resolve() <span class="keyword">as</span> <span class="type">Suit</span></span><br><span class="line"><span class="built_in">print</span>(suit.name)</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://yoichitgy.github.io/post/dependency-injection-framework-for-swift-introduction-to-swinject/" target="_blank" rel="external">Dependency Injection Framework for Swift - Introduction to Swinject</a></li>
<li><a href="http://ilya.puchka.me/ioc-container-in-swift/" target="_blank" rel="external">IoC container in Swift</a></li>
<li><a href="https://github.com/chakrit/swift-ioc" target="_blank" rel="external">swift-ioc</a></li>
<li><a href="https://github.com/AliSoftware/Dip" target="_blank" rel="external">Dip</a></li>
<li><a href="http://typhoonframework.org/" target="_blank" rel="external">Typhoon</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/18/a-simple-resolver-for-swift/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/18/a-dive-into-swift-2/" title="A dive into Swift 2" itemprop="url">A dive into Swift 2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-18T05:05:56.000Z" itemprop="datePublished"> Published 2015-12-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Here are some of my notes when diving into Swift</p>
<h2 id="Default-parameter-reorder"><a href="#Default-parameter-reorder" class="headerlink" title="Default parameter reorder"></a>Default parameter reorder</h2><p>If a function arguments have default values, you can reorder them at call site.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(num1 num1: Int = <span class="number">1</span>, num2: Int = <span class="number">2</span>)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> s = sum(num2: <span class="number">10</span>, num1: <span class="number">20</span>) <span class="comment">// 30</span></span><br></pre></td></tr></table></figure>
<p>Note that the first parameter <code>num1</code> must have external name</p>
<h2 id="Tuple-shuffle"><a href="#Tuple-shuffle" class="headerlink" title="Tuple shuffle"></a>Tuple shuffle</h2><p>See <a href="http://www.fantageek.com/blog/2015/11/27/tuple-shuffle-in-swift/">Tuple shuffle in Swift</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">"one"</span>, b = <span class="string">"two"</span></span><br><span class="line">(a, b) = (b, a)</span><br><span class="line"><span class="built_in">print</span>(a) <span class="comment">// "two"</span></span><br><span class="line"><span class="built_in">print</span>(b) <span class="comment">// "one"</span></span><br></pre></td></tr></table></figure>
<h2 id="Be-careful-with-generic"><a href="#Be-careful-with-generic" class="headerlink" title="Be careful with generic"></a>Be careful with generic</h2><p>Here is when I’m trying to do a <a href="https://github.com/onmyway133/Resolver" target="_blank" rel="external">Resolver</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">registerSingleton</span>&lt;T&gt;<span class="params">(singleton: T)</span></span> &#123;</span><br><span class="line">    register &#123;</span><br><span class="line">        singleton</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">register</span>&lt;T&gt;<span class="params">(factory: <span class="params">()</span></span></span> -&gt; <span class="type">T</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(factory.<span class="keyword">dynamicType</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here I mistakenly use it, because generic can accept any type, even closure</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">registerSingleton &#123;</span><br><span class="line">    <span class="string">"onmyway133"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And now <code>factory.dynamicType</code> is of type <code>() -&gt; () -&gt; String</code>, not what I expect <code>() -&gt; String</code></p>
<h2 id="Short-notation-works-for-any-static-member"><a href="#Short-notation-works-for-any-static-member" class="headerlink" title="Short notation works for any static member"></a>Short notation works for any static member</h2><ul>
<li><a href="http://bandes-stor.ch/blog/2015/11/28/help-yourself-to-some-swift/" target="_blank" rel="external">Help Yourself to Some Swift</a></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CAMediaTimingFunction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">EaseInEaseOut</span>: <span class="type">CAMediaTimingFunction</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">CAMediaTimingFunction</span>(name: kCAMediaTimingFunctionEaseInEaseOut)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> function: <span class="type">CAMediaTimingFunction</span> = .<span class="type">EaseInEaseOut</span></span><br></pre></td></tr></table></figure>
<p>We can also <code>.init</code> because the type of the property is already specified</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CAMediaTimingFunction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> <span class="type">EaseInEaseOut</span>: <span class="type">CAMediaTimingFunction</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .<span class="keyword">init</span>(name: kCAMediaTimingFunctionEaseInEaseOut)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Resolving-generic-type"><a href="#Resolving-generic-type" class="headerlink" title="Resolving generic type"></a>Resolving generic type</h2><p>Supposed we have contrived method like this, which does not accept any parameter</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resolve</span>&lt;T&gt;<span class="params">()</span></span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">String</span>(<span class="type">T</span>) == <span class="string">"String"</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"onmyway133"</span> <span class="keyword">as</span>! <span class="type">T</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>We can use <code>as</code> to resolve the type, or specify the type</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = resolve() <span class="keyword">as</span> <span class="type">String</span> <span class="comment">// "onmyway133"</span></span><br><span class="line"><span class="keyword">let</span> b: <span class="type">String</span> = resolve() <span class="comment">// "onmyway133"</span></span><br></pre></td></tr></table></figure>
<p>You can learn more when reading <a href="https://github.com/AliSoftware/Dip" target="_blank" rel="external">Dip</a></p>
<h2 id="Reference-instance-method"><a href="#Reference-instance-method" class="headerlink" title="Reference instance method"></a>Reference instance method</h2><ul>
<li><a href="http://oleb.net/blog/2014/07/swift-instance-methods-curried-functions/" target="_blank" rel="external">Instance Methods are Curried Functions in Swift</a></li>
</ul>
<p>Supposed we have</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span>() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">meo</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"meo meo"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We can make a reference to that instance method<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> cat = <span class="type">Cat</span>()</span><br><span class="line"><span class="keyword">let</span> ref = <span class="type">Cat</span>.meo</span><br><span class="line">ref(cat)()</span><br></pre></td></tr></table></figure></p>
<p>We can see that <code>ref</code> is of type <code>Cat -&gt; () -&gt; ()</code></p>
<h2 id="precondition"><a href="#precondition" class="headerlink" title="precondition"></a>precondition</h2><ul>
<li><a href="http://blog.krzyzanowskim.com/2015/03/09/swift-asserts-the-missing-manual/" target="_blank" rel="external">Swift asserts - the missing manual</a></li>
</ul>
<p>Check for a condition, works even in release mode.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(name: String)</span></span> &#123;</span><br><span class="line">    <span class="built_in">precondition</span>(!name.isEmpty, <span class="string">"Name must not be empty"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"hello "</span> + name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="strideof"><a href="#strideof" class="headerlink" title="strideof"></a>strideof</h2><ul>
<li><a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/BuildingCocoaApps/InteractingWithCAPIs.html#//apple_ref/doc/uid/TP40014216-CH8-ID185" target="_blank" rel="external">Data Type Size Calculation</a></li>
<li><a href="http://chris.eidhof.nl/posts/swift-c-interop.html" target="_blank" rel="external">http://chris.eidhof.nl/posts/swift-c-interop.html</a></li>
</ul>
<blockquote>
<p>In C, the sizeof operator returns the size of any variable or data type. In Swift, you use the sizeof function to get the size of a given type, or the sizeofValue function to get the size of the type of a given value</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">strideof</span>(timeval)) <span class="comment">// "16"</span></span><br></pre></td></tr></table></figure>
<h2 id="Arguments-are-tuple"><a href="#Arguments-are-tuple" class="headerlink" title="Arguments are tuple"></a>Arguments are tuple</h2><ul>
<li><p><a href="https://medium.com/swift-programming/tuple-as-function-argument-619523b6e06b#.n05z7mpbw" target="_blank" rel="external">Tuple as Function arguments</a></p>
</li>
<li><p>Tuple elements must be the same number, of the same types, and have the same external parameter name as in function</p>
</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">greet</span><span class="params">(name: String, age: Int)</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Hello, this is "</span> + name + <span class="string">", \(age) years old"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> params = (<span class="string">"Luke"</span>, age: <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line">greet(params)</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/18/a-dive-into-swift-2/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/08/pattern-matching-in-swift-2/" title="Pattern matching in Swift 2" itemprop="url">Pattern matching in Swift 2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-08T02:49:23.000Z" itemprop="datePublished"> Published 2015-12-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://austinzheng.com/2015/09/23/pmatch-control-flow/" target="_blank" rel="external">Swift 2: Control Flow Pattern Matching Examples</a></li>
<li><a href="http://appventure.me/2015/08/20/swift-pattern-matching-in-detail/" target="_blank" rel="external">Match Me if you can: Swift Pattern Matching in Detail</a></li>
<li><a href="http://blog.krzyzanowskim.com/2015/11/13/where-where-may-be-used/" target="_blank" rel="external">Where “where” may be used</a></li>
<li><a href="http://www.figure.ink/blog/2015/12/6/matching-with-swifts-optional-pattern" target="_blank" rel="external">Matching with Swift’s Optional Pattern</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/08/pattern-matching-in-swift-2/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/07/parsing-json-in-swift-2/" title="Parsing JSON in Swift 2" itemprop="url">Parsing JSON in Swift 2</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-07T01:55:44.000Z" itemprop="datePublished"> Published 2015-12-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/SwiftyJSON/SwiftyJSON" target="_blank" rel="external">SwiftyJSON</a></li>
<li><a href="https://github.com/thoughtbot/Argo" target="_blank" rel="external">Argo</a></li>
<li><a href="https://github.com/Weebly/Cereal" target="_blank" rel="external">Cereal</a></li>
<li><a href="https://github.com/LoganWright/Genome" target="_blank" rel="external">Genome</a></li>
<li><a href="https://github.com/lyft/mapper" target="_blank" rel="external">mapper</a></li>
<li><a href="https://github.com/Hearst-DD/ObjectMapper" target="_blank" rel="external">ObjectMapper</a></li>
<li><a href="https://github.com/matthewcheok/JSONCodable" target="_blank" rel="external">JSONCodable</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/07/parsing-json-in-swift-2/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/04/open-source-licenses/" title="Open source licenses" itemprop="url">Open source licenses</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-04T15:38:39.000Z" itemprop="datePublished"> Published 2015-12-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Swift is open source, here at <a href="https://github.com/apple/swift" target="_blank" rel="external">swift</a> and <a href="https://swift.org/" target="_blank" rel="external">Swift.org</a>. And for now it uses <a href="https://github.com/apple/swift/blob/master/LICENSE.txt" target="_blank" rel="external">Apache license</a></p>
<p>There is a joke on this pull request <a href="https://github.com/apple/swift/pull/17" target="_blank" rel="external">I think we should use GPL v3 instead, it’s the future of open source.</a></p>
<p>When developing iOS apps, most of the libraries I use are on MIT licenses, a permissive license, which is good :]</p>
<h2 id="MIT-vs-GPL-vs-Apache"><a href="#MIT-vs-GPL-vs-Apache" class="headerlink" title="MIT vs GPL vs Apache"></a>MIT vs GPL vs Apache</h2><p>These have many things in common</p>
<ul>
<li>Commercial Use: This software and derivatives may be used for commercial purposes.</li>
<li>Distribution: You may distribute this software.</li>
<li>Modification: This software may be modified.</li>
<li>Private use: You may use and modify the software without distributing it.</li>
<li>License and copyright notice: Include a copy of the license and copyright notice with the code.</li>
</ul>
<h2 id="But"><a href="#But" class="headerlink" title="But"></a>But</h2><p>GPL is Disclose Source: copyleft license that requires anyone who distributes your code or a derivative work to make the source available under the same terms.</p>
<p>Apache is Patent Grant and State Changes: Indicate significant changes made to the code</p>
<p>MIT is simple, permissive. You can do anything you like</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://choosealicense.com/licenses/" target="_blank" rel="external">Choose a license</a></li>
<li><a href="https://mike-ochmann.de/occupygpl/" target="_blank" rel="external">The movement to encourage the usage of permissive open source licenses.</a></li>
<li><a href="https://noordering.wordpress.com/2009/01/20/why-the-gpl-is-not-free/" target="_blank" rel="external">Why the GPL is not free</a></li>
<li><a href="http://www.kaybee.org/~kirk/GPL.html" target="_blank" rel="external">Why I don’t use the GPL</a></li>
<li><a href="http://artsy.github.io/blog/2015/12/10/License-and-You/" target="_blank" rel="external">License for OSS Code</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/04/open-source-licenses/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/04/optional-in-swift/" title="Optional in Swift" itemprop="url">Optional in Swift</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-12-04T10:50:20.000Z" itemprop="datePublished"> Published 2015-12-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Meet-Optional"><a href="#Meet-Optional" class="headerlink" title="Meet Optional"></a>Meet Optional</h2><p>You have seen these</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The image object for the specified file, or nil if the method could not find the specified image.</span></span><br><span class="line"><span class="keyword">init</span>?(named name: <span class="type">String</span>) -&gt; <span class="type">UIImage</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Returns the first element of self, or nil if self is empty.</span></span><br><span class="line"><span class="keyword">var</span> first: <span class="type">Self</span>.<span class="type">Generator</span>.<span class="type">Element</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The index path of the cell or nil if the specified cell is not in the collection view</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexPathForCell</span><span class="params">(<span class="number">_</span> cell: UICollectionViewCell)</span></span> -&gt; <span class="type">NSIndexPath</span>?</span><br></pre></td></tr></table></figure>
<p>You will see lots of optional throughout Foundation and UIKit. It represents a context in which there is a value, or there is not.</p>
<p>In Objective, you can have a pointer which can points to something, or nil. But Optional makes it more generic. You can now have <code>Int?, UIImage?, String?, UIWindow? ...</code></p>
<p>The idea of optional type is not new, you may have seen it through <code>data Maybe a = Nothing | Just a</code> in Haskell, <code>enum Option&lt;T&gt; { None, Some(T) }</code> in Rust, <code>Optional&lt;T&gt;</code> in Java 8, <code>System.Nullable&lt;T&gt;</code> in C#, …</p>
<p>In Swift, optional is all about <code>?</code> and <code>!</code>. The latter is for the lazy one</p>
<h2 id="Optional-is-enum"><a href="#Optional-is-enum" class="headerlink" title="Optional is enum"></a>Optional is enum</h2><h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><p>Optional is implemented using associated type enum and generic</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Optional</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Some</span>(<span class="type">T</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">None</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Declaration"><a href="#Declaration" class="headerlink" title="Declaration"></a>Declaration</h3><p>When you see<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"hello world"</span></span><br></pre></td></tr></table></figure></p>
<p>It is actually<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="type">Optional</span>&lt;<span class="type">String</span>&gt;.<span class="type">Some</span>(<span class="string">"hello world"</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="Checking"><a href="#Checking" class="headerlink" title="Checking"></a>Checking</h3><p>When you see<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name = name &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>It is actually<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Some</span>(name) = name &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Forced-Unwrapping"><a href="#Forced-Unwrapping" class="headerlink" title="Forced Unwrapping"></a>Forced Unwrapping</h2><p>You can use <code>!</code> to forcibly unwrap an optional. If there isn’t a value, it will crash <code>fatal error: unexpectedly found nil while unwrapping an Optional value</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"Fantageek"</span></span><br><span class="line"><span class="built_in">print</span>(name!)</span><br></pre></td></tr></table></figure>
<h3 id="Implementation-1"><a href="#Implementation-1" class="headerlink" title="Implementation"></a>Implementation</h3><p>Forced Unwrapping operator <code>!</code> is implemented like this</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="type">Optional</span>&lt;<span class="type">String</span>&gt;.<span class="type">Some</span>(<span class="string">"Fantageek"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">postfix</span> <span class="keyword">operator</span> ! &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">postfix</span> <span class="function"><span class="keyword">func</span> !&lt;T&gt; <span class="params">(<span class="keyword">optional</span>: Optional&lt;T&gt;)</span></span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Some</span>(value) = <span class="keyword">optional</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">fatalError</span>(<span class="string">"unexpectedly found nil while unwrapping an Optional value"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(name!)</span><br></pre></td></tr></table></figure>
<h2 id="Implicitly-Unwrapped-Optionals"><a href="#Implicitly-Unwrapped-Optionals" class="headerlink" title="Implicitly Unwrapped Optionals"></a>Implicitly Unwrapped Optionals</h2><p>Optional is good, but you need to check for its value every time you need to use</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"Fantageek"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name = name &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In case you ‘re sure that the optional always has a value, you can use <code>!</code> to define <code>Implicitly Unwrapped Optionals</code>, which is an optional that automatically unwraps its value when you use it</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>! = <span class="string">"Fantageek"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Just use it</span></span><br><span class="line"><span class="built_in">print</span>(name)</span><br></pre></td></tr></table></figure>
<p>Implicitly Unwrapped Optionals are Optionals, so you can check for nil and use optional binding</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> name = name &#123;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Optional-in-collection"><a href="#Optional-in-collection" class="headerlink" title="Optional in collection"></a>Optional in collection</h2><p>Because optional is an enum, we can have collection of values and nils</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names: [<span class="type">String</span>?] = [<span class="string">"Shanks"</span>, <span class="string">"Big Mom"</span>, <span class="literal">nil</span>, <span class="string">"Kaido"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fruits: [<span class="type">String</span>: <span class="type">String</span>?] = [</span><br><span class="line">    <span class="string">"Luffy"</span>: <span class="string">"Gomu Gomu"</span>,</span><br><span class="line">    <span class="string">"Zoro"</span>: <span class="literal">nil</span>,</span><br><span class="line">    <span class="string">"Ace"</span>: <span class="string">"Mera Mera"</span>,</span><br><span class="line">    <span class="string">"Shanks"</span>: <span class="literal">nil</span>,</span><br><span class="line">    <span class="string">"Smoker"</span>: <span class="string">"Moku Moku"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="Optional-binding"><a href="#Optional-binding" class="headerlink" title="Optional binding"></a>Optional binding</h2><p>We can use optional binding through <code>if let</code>. Even cooler, Swift now support multiple optional binding</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstName: <span class="type">String</span>? = <span class="string">"Monkey"</span></span><br><span class="line"><span class="keyword">let</span> lastName: <span class="type">String</span>? = <span class="string">"Luffy"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> firstName = firstName, lastName = lastName &#123;</span><br><span class="line">    <span class="built_in">print</span>(firstName + <span class="string">" "</span> + lastName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Double-optional"><a href="#Double-optional" class="headerlink" title="Double optional"></a>Double optional</h2><p>Swift has special syntax for double optional, that is <code>??</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>?? = <span class="string">"hello world"</span> <span class="comment">// Optional&lt;Optional&lt;String&gt;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> outer = name, inner = outer &#123;</span><br><span class="line">    <span class="built_in">print</span>(inner)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Double optional is also a result of a this cast</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">AnyObject</span>? = <span class="string">"Fantageek"</span></span><br><span class="line"><span class="keyword">let</span> result = name <span class="keyword">as</span>? <span class="type">String</span>? <span class="comment">// String??</span></span><br></pre></td></tr></table></figure>
<h2 id="Nil-Coalescing-Operator"><a href="#Nil-Coalescing-Operator" class="headerlink" title="Nil Coalescing Operator"></a>Nil Coalescing Operator</h2><blockquote>
<p>The nil coalescing operator (a ?? b) unwraps an optional a if it contains a value, or returns a default value b if a is nil.</p>
</blockquote>
<p>The right hand of <code>??</code> is actually a closure</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> ??&lt;T&gt;<span class="params">(<span class="keyword">optional</span>: T?, defaultValue: @autoclosure <span class="params">()</span></span></span> -&gt; <span class="type">T</span>) -&gt; <span class="type">T</span></span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"Fantageek"</span></span><br><span class="line"><span class="keyword">let</span> website = name ?? <span class="string">"No website"</span></span><br></pre></td></tr></table></figure>
<p>It can be chained</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = maybe ?? possibly ?? <span class="string">"default"</span></span><br></pre></td></tr></table></figure>
<p>It works in string interpolation, too</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> website = <span class="string">"\(name ?? "</span><span class="type">No</span> website<span class="string">")"</span></span><br></pre></td></tr></table></figure>
<p>It is implemented like this</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a != <span class="literal">nil</span> ? a! : b</span><br></pre></td></tr></table></figure>
<h2 id="Optional-chaining"><a href="#Optional-chaining" class="headerlink" title="Optional chaining"></a>Optional chaining</h2><p>Optional might be nil, so querying for its methods, properties, subscripts will return another optional</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"Fantageek"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> uppercase = name?.uppercaseString <span class="comment">// String?</span></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">count</span> = name?.characters.<span class="built_in">count</span> <span class="comment">// Distance?</span></span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> items:[<span class="type">Int</span>?] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="literal">nil</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"><span class="keyword">let</span> item = items[<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<h3 id="Optional-delegate"><a href="#Optional-delegate" class="headerlink" title="Optional delegate"></a>Optional delegate</h3><p>A delegate might be nil, and it might not implement optional methods. So we must use <code>?</code> when calling it</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> delegate: <span class="type">UITableViewDataSource</span>? = <span class="comment">// get from somewhere</span></span><br><span class="line"><span class="keyword">let</span> tableView = <span class="type">UITableView</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sectionCount = delegate?.numberOfSectionsInTableView?(tableView) <span class="comment">// Int?</span></span><br></pre></td></tr></table></figure>
<h3 id="Optional-callback"><a href="#Optional-callback" class="headerlink" title="Optional callback"></a>Optional callback</h3><p>A callback might be nil</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> callback: (<span class="type">String</span>? -&gt; <span class="type">Void</span>)? = <span class="comment">// get from somwhere</span></span><br><span class="line"></span><br><span class="line">callback?(<span class="string">"a response"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Optional-pattern"><a href="#Optional-pattern" class="headerlink" title="Optional pattern"></a>Optional pattern</h2><blockquote>
<p>The new optional pattern, myValue?, is equivalent to .Some(myValue) for optionals</p>
</blockquote>
<p>If you have an optional enum</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Sword</span>(attack: <span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Shield</span>(defense: <span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Potion</span>(property: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> weapon: <span class="type">Weapon</span>? = .<span class="type">Sword</span>(attack: <span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>You can ask for the case</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> .<span class="type">Sword</span>? = weapon &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a sword"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> .<span class="type">Some</span>(.<span class="type">Sword</span>) = weapon &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"a sword"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can ask for the value associated with the case</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Sword</span>(attack)? = weapon &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"attack "</span> + <span class="string">"\(attack)"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Some</span>(.<span class="type">Sword</span>(attack)) = weapon &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"attack "</span> + <span class="string">"\(attack)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Of course, it works with <code>switch</code>, too</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> weapon &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Sword</span>(attack)?:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"attack "</span> + <span class="string">"\(attack)"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">""</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// equivalent</span></span><br><span class="line"><span class="keyword">switch</span> weapon &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">Some</span>(.<span class="type">Sword</span>(attack)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"attack "</span> + <span class="string">"\(attack)"</span>)</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">""</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>An optional pattern matches values wrapped in a Some(Wrapped) case of an Optional<wrapped> or ImplicitlyUnwrappedOptional<wrapped> enumeration</wrapped></wrapped></p>
</blockquote>
<p>These are equivalent</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someOptional: <span class="type">Int</span>? = <span class="number">42</span></span><br><span class="line"><span class="comment">// Match using an enumeration case pattern</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> .<span class="type">Some</span>(<span class="keyword">let</span> x) = someOptional &#123;</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Match using an optional pattern</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">case</span> <span class="keyword">let</span> x? = someOptional &#123;</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>The optional pattern provides a convenient way to iterate over an array of optional values in a for-in statement, executing the body of the loop only for non-nil elements.</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayOfOptionalInts: [<span class="type">Int</span>?] = [<span class="literal">nil</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="literal">nil</span>, <span class="number">5</span>]</span><br><span class="line"><span class="comment">// Match only non-nil values</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">case</span> <span class="keyword">let</span> number? <span class="keyword">in</span> arrayOfOptionalInts &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Found a \(number)"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Cast"><a href="#Cast" class="headerlink" title="Cast"></a>Cast</h2><p>There are <code>as?</code> and <code>as!</code>, see <a href="http://www.fantageek.com/blog/2015/09/23/type-casting-in-swift/">Type Casting in Swift 2</a></p>
<h2 id="Initializer"><a href="#Initializer" class="headerlink" title="Initializer"></a>Initializer</h2><h3 id="Failable-Initializers"><a href="#Failable-Initializers" class="headerlink" title="Failable Initializers"></a>Failable Initializers</h3><blockquote>
<p>A failable initializer creates an optional value of the type it initializes</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> species: <span class="type">String</span></span><br><span class="line">    <span class="keyword">init</span>?(species: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> species.isEmpty &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">        <span class="keyword">self</span>.species = species</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> someCreature = <span class="type">Animal</span>(species: <span class="string">"Giraffe"</span>) <span class="comment">// Animal?</span></span><br></pre></td></tr></table></figure>
<p>Swift also supports <code>The init! Failable Initializer</code></p>
<h2 id="Throw"><a href="#Throw" class="headerlink" title="Throw"></a>Throw</h2><p><code>try?</code> tries to perform an operation that may throw, returns an optional containing the returned value if succeeded. <code>try!</code> does the same, but you get an Implicitly Unwrapped Optional</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Error</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">NotAMember</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isInStrawHatPirates</span><span class="params">(name: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> members = [</span><br><span class="line">        <span class="string">"Monkey D. Luffy"</span>,</span><br><span class="line">        <span class="string">"Roronoa Zoro"</span>,</span><br><span class="line">        <span class="string">"Nami"</span>,</span><br><span class="line">        <span class="string">"Usopp"</span>,</span><br><span class="line">        <span class="string">"Sanji"</span>,</span><br><span class="line">        <span class="string">"Chopper"</span>,</span><br><span class="line">        <span class="string">"Nico Robin"</span>,</span><br><span class="line">        <span class="string">"Franky"</span>,</span><br><span class="line">        <span class="string">"Brook"</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> members.<span class="built_in">contains</span>(name) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"welcome"</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="type">Error</span>.<span class="type">NotAMember</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> message = <span class="keyword">try</span>? isInStrawHatPirates(<span class="string">"Sanji"</span>) <span class="comment">// String?</span></span><br></pre></td></tr></table></figure>
<h2 id="Functional-optional"><a href="#Functional-optional" class="headerlink" title="Functional optional"></a>Functional optional</h2><p>Optional is a functor, applicative functor, and monad</p>
<p>Note that all these methods are implemented as extension on Optional, see my <a href="https://gist.github.com/onmyway133/48c969c8baf4e7e77ee0" target="_blank" rel="external">gist</a></p>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><blockquote>
<p>If self == nil, returns nil. Otherwise, returns f(self!).</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countCharacters</span><span class="params">(string: String)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> string.characters.<span class="built_in">count</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">count</span> = name.<span class="built_in">map</span>(countCharacters) <span class="comment">// Int?</span></span><br></pre></td></tr></table></figure>
<p>It is implemented like this</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Optional</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;U&gt;<span class="params">(@noescape f: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">U</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> value = <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">try</span> f(value)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h3><blockquote>
<p>Returns nil if self is nil, f(self!) otherwise.</p>
</blockquote>
<p>Let ‘s use <code>countCharactersIfNotEmpty</code>, a function returning nil if it receives empty string. Yeah, it does not like empty string</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countCharactersIfNotEmpty</span><span class="params">(string: String)</span></span> -&gt; <span class="type">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">if</span> string.isEmpty &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> string.characters.<span class="built_in">count</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="built_in">count</span> = name.flatMap(countCharactersIfNotEmpty) <span class="comment">// Int?</span></span><br></pre></td></tr></table></figure>
<p>It is implemented like this</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;U&gt;<span class="params">(@noescape f: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">U</span>?) <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> value = <span class="keyword">self</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">try</span> f(value)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="map-vs-flatMap"><a href="#map-vs-flatMap" class="headerlink" title="map vs flatMap"></a>map vs flatMap</h3><p>Note that in <code>map</code>, <code>f</code> is of type <code>Wrapped -&gt; U</code>, while in <code>flatMap</code>, <code>f</code> is of type <code>Wrapped -&gt; U?</code></p>
<p>If you use <code>map</code> with <code>Wrapped -&gt; U?</code>, you ‘ll get double optional</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> countWithMap = name.<span class="built_in">map</span>(countCharactersIfNotEmpty)  <span class="comment">// Int??</span></span><br><span class="line"><span class="keyword">let</span> countWithFlatMap = name.flatMap(countCharactersIfNotEmpty) <span class="comment">// Int?</span></span><br></pre></td></tr></table></figure>
<p><code>flatMap</code> can also be implemented using <code>map + flatten</code>, hence the name <code>flatMap</code>. As you already know, it is called <code>Forced Unwrapping</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">flatMap</span>&lt;U&gt;<span class="params">(@noescape f: <span class="params">(Wrapped)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">U</span>?) <span class="keyword">rethrows</span> -&gt; <span class="type">U</span>? &#123;</span><br><span class="line">        <span class="keyword">let</span> result = <span class="keyword">try</span> <span class="keyword">self</span>.<span class="built_in">map</span>(f) <span class="comment">// U??</span></span><br><span class="line">        <span class="keyword">return</span> result!</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h3><p>Here is how Optional works like applicative functor, note that <code>f</code> is of type <code>(Wrapped -&gt; U)?</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"Fantageek"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> function: (<span class="type">String</span> -&gt; <span class="type">Int</span>)? = countCharacters</span><br><span class="line"><span class="keyword">let</span> countWithApply = name.apply(function) <span class="comment">// Int?</span></span><br></pre></td></tr></table></figure>
<p>This is how it is implemented</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">apply</span>&lt;U&gt;<span class="params">(f: <span class="params">(Wrapped -&gt; U)</span></span></span>?) -&gt; <span class="type">U</span>? &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> f = f &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.<span class="built_in">map</span>(f)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://en.wikipedia.org/wiki/Option_type" target="_blank" rel="external">Option type</a></li>
<li><a href="http://austinzheng.com/2015/09/23/pmatch-control-flow/" target="_blank" rel="external">Swift 2: Control Flow Pattern Matching Example</a></li>
<li><a href="http://ericasadun.com/2015/11/05/implementing-printing-versions-of-try-and-try-on-steroids-in-swiftlang/" target="_blank" rel="external">Implementing printing versions of “try?” and “try!” — on steroids! in #swiftlang</a></li>
<li><a href="http://appventure.me/2015/08/20/swift-pattern-matching-in-detail/#sec-4-1" target="_blank" rel="external">Match Me if you can: Swift Pattern Matching in Detail</a></li>
<li><a href="http://www.drewag.me/posts/what-is-an-optional-in-swift" target="_blank" rel="external">What is an Optional in Swift</a></li>
<li><a href="http://www.uraimo.com/2015/10/08/Swift2-map-flatmap-demystified/" target="_blank" rel="external">Swift 2.0: Map and FlatMap Demystified</a></li>
<li><a href="http://blog.xebia.com/the-power-of-map-and-flatmap-of-swift-optionals/" target="_blank" rel="external">The Power Of Map And FlatMap Of Swift Optionals</a></li>
<li><a href="http://www.javiersoto.me/post/106875422394" target="_blank" rel="external">Functor and Monad in Swift </a></li>
<li><a href="http://www.mokacoding.com/blog/functor-applicative-monads-in-pictures/" target="_blank" rel="external">Swift Functors, Applicatives, and Monads in Pictures</a></li>
<li><a href="http://www.figure.ink/blog/2015/12/6/matching-with-swifts-optional-pattern" target="_blank" rel="external">Matching with Swift’s Optional Pattern</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/12/04/optional-in-swift/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/3/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="onmyway133" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Script/" title="Java Script">Java Script<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Life/" title="Life">Life<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Miscellaneous/" title="Miscellaneous">Miscellaneous<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mobile-Labs/" title="Mobile Labs">Mobile Labs<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/" title="Others">Others<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming/" title="Programming">Programming<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/Windows-8/" title="Windows 8">Windows 8<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/" title="Windows 8">Windows 8<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-Phone/" title="Windows Phone">Windows Phone<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/Windows-Phone/" title="Windows Phone">Windows Phone<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>84</sup></a></li>
		  
		
		  
			<li><a href="/categories/programming/" title="programming">programming<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/ios/" title="ios">ios<sup>20</sup></a></li>
			
		
			
				<li><a href="/tags/wp7/" title="wp7">wp7<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/tutorial/" title="tutorial">tutorial<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/mac-osx/" title="mac osx">mac osx<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/convert/" title="convert">convert<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/windows-8/" title="windows 8">windows 8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/wp8/" title="wp8">wp8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C">C<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/file/" title="file">file<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/programming/" title="programming">programming<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/disable/" title="disable">disable<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/facebook/" title="facebook">facebook<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/voip/" title="voip">voip<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/xcode/" title="xcode">xcode<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/openssl/" title="openssl">openssl<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/project/" title="project">project<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/build/" title="build">build<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/svn/" title="svn">svn<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/visual-studio/" title="visual studio">visual studio<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> A dream is not a dream anymore when you don&#39;t have time for it <br/>
			What you don&#39;t know is what you haven&#39;t learned</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/onmyway133" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/1418457/onmyway133" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/onmyway133" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		
		
		
		
		
		<a href="mailto:onmyway133@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Khoa Pham">Khoa Pham</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-40119591-1', 'fantageek.com');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
