
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>Fantageek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Khoa Pham">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Fantageek">
<meta property="og:url" content="http://www.fantageek.com/page/6/index.html">
<meta property="og:site_name" content="Fantageek">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fantageek">
<meta name="twitter:description">
<meta name="twitter:creator" content="@onmyway133">

    
    <link rel="alternative" href="/atom.xml" title="Fantageek" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Fantageek" title="Fantageek"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Fantageek">Fantageek</a></h1>
				<h2 class="blog-motto">Simple apps that make sense</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:www.fantageek.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/28/understanding-sdwebimage-clean/" title="Understanding SDWebImage - Clean" itemprop="url">Understanding SDWebImage - Clean</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-28T13:20:11.000Z" itemprop="datePublished"> Published 2015-06-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="clearDisk"><a href="#clearDisk" class="headerlink" title="clearDisk"></a>clearDisk</h2><p>Erase all files on disk cache. In <code>SDImageCache.m</code><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)clearDiskOnCompletion:(SDWebImageNoParamsBlock)completion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">        [_fileManager removeItemAtPath:<span class="keyword">self</span>.diskCachePath error:<span class="literal">nil</span>];</span><br><span class="line">        [_fileManager createDirectoryAtPath:<span class="keyword">self</span>.diskCachePath</span><br><span class="line">                withIntermediateDirectories:<span class="literal">YES</span></span><br><span class="line">                                 attributes:<span class="literal">nil</span></span><br><span class="line">                                      error:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (completion) &#123;</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                completion();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="cleanDisk"><a href="#cleanDisk" class="headerlink" title="cleanDisk"></a>cleanDisk</h2><p>Erase some files based on cache time and cache size<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock &#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">   <span class="comment">// Erase old files</span></span><br><span class="line">   <span class="built_in">NSDate</span> *expirationDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:-<span class="keyword">self</span>.maxCacheAge];</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> *cacheFiles = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="built_in">NSUInteger</span> currentCacheSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Enumerate all of the files in the cache directory.  This loop has two purposes:</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">//  1. Removing files that are older than the expiration date.</span></span><br><span class="line">        <span class="comment">//  2. Storing file attributes for the size-based cleanup pass.</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *urlsToDelete = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// Erase more until cache size is preservered</span></span><br><span class="line">    <span class="comment">// If our remaining disk cache exceeds a configured maximum size, perform a second</span></span><br><span class="line">        <span class="comment">// size-based cleanup pass.  We delete the oldest files first.</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.maxCacheSize &gt; <span class="number">0</span> &amp;&amp; currentCacheSize &gt; <span class="keyword">self</span>.maxCacheSize) &#123;</span><br><span class="line">            <span class="comment">// Target half of our maximum cache size for this cleanup pass.</span></span><br><span class="line">            <span class="keyword">const</span> <span class="built_in">NSUInteger</span> desiredCacheSize = <span class="keyword">self</span>.maxCacheSize / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/28/understanding-sdwebimage-clean/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/18/understanding-sdwebimage-cache/" title="Understanding SDWebImage - Cache" itemprop="url">Understanding SDWebImage - Cache</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T15:26:48.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>SDWebImage stores UIImage in <code>memCache</code> first, then into disk. UIImage gets compressed to <code>NSData</code> before going to disk<br>In <code>SDImageCache.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image recalculateFromImage:(<span class="built_in">BOOL</span>)recalculate imageData:(<span class="built_in">NSData</span> *)imageData forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk &#123;</span><br><span class="line">    <span class="keyword">if</span> (!image || !key) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span>.memCache setObject:image forKey:key cost:image.size.height * image.size.width * image.scale * image.scale];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (toDisk) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imageIsPng) &#123;</span><br><span class="line">                    data = <span class="built_in">UIImagePNGRepresentation</span>(image);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    data = <span class="built_in">UIImageJPEGRepresentation</span>(image, (<span class="built_in">CGFloat</span>)<span class="number">1.0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">                data = [<span class="built_in">NSBitmapImageRep</span> representationOfImageRepsInArray:image.representations usingType: <span class="built_in">NSJPEGFileType</span> properties:<span class="literal">nil</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                <span class="keyword">if</span> (![_fileManager fileExistsAtPath:_diskCachePath]) &#123;</span><br><span class="line">                    [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:<span class="literal">YES</span> attributes:<span class="literal">nil</span> error:<span class="literal">NULL</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                [_fileManager createFileAtPath:[<span class="keyword">self</span> defaultCachePathForKey:key] contents:data attributes:<span class="literal">nil</span>];</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that <code>NSFileManager</code> <code>createFileAtPath:contents:data:attributes:nil:</code> returns NO if the write operation fails. This includes not enough disk space. See <a href="http://stackoverflow.com/a/7618759/1418457" target="_blank" rel="external">detect no disk space iPhone SDK</a></p>
<h2 id="Retrieval"><a href="#Retrieval" class="headerlink" title="Retrieval"></a>Retrieval</h2><p>SDWebImage will first check to see if the images are in local before going to make network request<br>In <code>SDImageCache.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSOperation</span> *)queryDiskCacheForKey:(<span class="built_in">NSString</span> *)key done:(SDWebImageQueryCompletedBlock)doneBlock &#123;</span><br><span class="line">    <span class="keyword">if</span> (!doneBlock) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">        doneBlock(<span class="literal">nil</span>, SDImageCacheTypeNone);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// First check the in-memory cache...</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];</span><br><span class="line">    <span class="keyword">if</span> (image) &#123;</span><br><span class="line">        doneBlock(image, SDImageCacheTypeMemory);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSOperation</span> *operation = [<span class="built_in">NSOperation</span> new];</span><br><span class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">        <span class="keyword">if</span> (operation.isCancelled) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">            <span class="built_in">UIImage</span> *diskImage = [<span class="keyword">self</span> diskImageForKey:key];</span><br><span class="line">            <span class="keyword">if</span> (diskImage) &#123;</span><br><span class="line">                <span class="built_in">CGFloat</span> cost = diskImage.size.height * diskImage.size.width * diskImage.scale * diskImage.scale;</span><br><span class="line">                [<span class="keyword">self</span>.memCache setObject:diskImage forKey:key cost:cost];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                doneBlock(diskImage, SDImageCacheTypeDisk);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="How-UIImage-is-created"><a href="#How-UIImage-is-created" class="headerlink" title="How UIImage is created"></a>How UIImage is created</h2><p>SDWebImage uses <code>SDWebImageDownloaderOperation</code> and <code>NSURLConnection</code> to kick off network requests.<br>UIImage is created by a call to <code>sd_imageWithData:</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">UIImage</span> *)sd_imageWithData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *image;</span><br><span class="line">    <span class="built_in">NSString</span> *imageContentType = [<span class="built_in">NSData</span> sd_contentTypeForImageData:data];</span><br><span class="line">    <span class="keyword">if</span> ([imageContentType isEqualToString:<span class="string">@"image/gif"</span>]) &#123;</span><br><span class="line">        image = [<span class="built_in">UIImage</span> sd_animatedGIFWithData:data];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#ifdef SD_WEBP</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([imageContentType isEqualToString:<span class="string">@"image/webp"</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        image = [<span class="built_in">UIImage</span> sd_imageWithWebPData:data];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        image = [[<span class="built_in">UIImage</span> alloc] initWithData:data];</span><br><span class="line">        <span class="built_in">UIImageOrientation</span> orientation = [<span class="keyword">self</span> sd_imageOrientationFromImageData:data];</span><br><span class="line">        <span class="keyword">if</span> (orientation != <span class="built_in">UIImageOrientationUp</span>) &#123;</span><br><span class="line">            image = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:image.CGImage</span><br><span class="line">                                        scale:image.scale</span><br><span class="line">                                  orientation:orientation];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Use-another-SDImageCache"><a href="#Use-another-SDImageCache" class="headerlink" title="Use another SDImageCache"></a>Use another SDImageCache</h2><p>From <a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a>,</p>
<blockquote><br>  It is also possible to use the async based image cache store independently. SDImageCache maintains a memory cache and an optional disk cache. Disk cache write operations are performed asynchronous so it doesn’t add unnecessary latency to the UI.<br>  The SDImageCache class provides a singleton instance for convenience but you can create your own instance if you want to create separated cache namespace<br></blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/18/understanding-sdwebimage-cache/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/18/understanding-mantle-value-transformer/" title="Understanding Mantle - Value Transformer" itemprop="url">Understanding Mantle - Value Transformer</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:34:53.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Mantle is my number 1 choice for the model class. It has a lot of predefined value transformers, you can take a look at NSValueTransformer+MTLInversionAdditions and NSValueTransformer+MTLPredefinedTransformerAdditions.</p>
<h3 id="Predefined-value-transformer"><a href="#Predefined-value-transformer" class="headerlink" title="Predefined value transformer"></a>Predefined value transformer</h3><p>Currently Mantle 1.5 supports these value transformers</p>
<p>mtl_invertedTransformer<br>mtl_JSONDictionaryTransformerWithModelClass<br>mtl_JSONArrayTransformerWithModelClass<br>mtl_valueMappingTransformerWithDictionary<br>URLValueTransformer<br>booleanValueTransformer</p>
<p>The transformer without parameters (like URLValueTransformer and booleanValueTransformer are registered with NSValueTransformer in the “load” method</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(void)load {<br>  @autoreleasepool {</p>
<pre><code>MTLValueTransformer *URLValueTransformer = [MTLValueTransformer
    reversibleTransformerWithForwardBlock:^ id (NSString *str) {
        if (![str isKindOfClass:NSString.class]) return nil;
        return [NSURL URLWithString:str];
    }
    reverseBlock:^ id (NSURL *URL) {
        if (![URL isKindOfClass:NSURL.class]) return nil;
        return URL.absoluteString;
    }];

[NSValueTransformer setValueTransformer:URLValueTransformer forName:MTLURLValueTransformerName];

MTLValueTransformer *booleanValueTransformer = [MTLValueTransformer
    reversibleTransformerWithBlock:^ id (NSNumber *boolean) {
        if (![boolean isKindOfClass:NSNumber.class]) return nil;
        return (NSNumber *)(boolean.boolValue ? kCFBooleanTrue : kCFBooleanFalse);
    }];

[NSValueTransformer setValueTransformer:booleanValueTransformer forName:MTLBooleanValueTransformerName];
</code></pre><p>  }<br>}<br>[/code]</p>
</li>
</ul>
<p>But eventually, those transformers end up calling reversibleTransformerWithForwardBlock:reverseBlock: and the real converter is the MTLJSONAdapter</p>
<h3 id="Custom-value-transformer"><a href="#Custom-value-transformer" class="headerlink" title="Custom value transformer"></a>Custom value transformer</h3><p>If those value transformer do not suit your need. You can learn from what Mantle already does, and build your own value transformer</p>
<p>For example, this is a custom value transformer from my FTGValueTransformer that converts the first object in a JSON array to a model</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(NSValueTransformer <em>)ftg_JSONFirstObjectInArrayTransformerWithModelClass:(Class)modelClass {<br>  NSValueTransformer </em>dictionaryTransformer = [self mtl_JSONDictionaryTransformerWithModelClass:modelClass];</p>
<p>  return [MTLValueTransformer</p>
<pre><code>reversibleTransformerWithForwardBlock:^ id (NSArray *dictionaries) {
    if (dictionaries == nil || dictionaries.count == 0) {
        return nil;
    }

    NSAssert([dictionaries isKindOfClass:NSArray.class], @&quot;Expected a array of dictionaries, got: %@&quot;, dictionaries);

    NSDictionary *firstDictionary = [dictionaries firstObject];

    NSAssert([firstDictionary isKindOfClass:NSDictionary.class], @&quot;Expected a dictionary or an NSNull, got: %@&quot;, firstDictionary);

    id model = [dictionaryTransformer transformedValue:firstDictionary];

    return model;
}
reverseBlock:^ id (id model) {
    if (model == nil) {
        return nil;
    }

    NSAssert([model isKindOfClass:MTLModel.class], @&quot;Expected an MTLModel or an NSNull, got: %@&quot;, model);

    NSDictionary *dict = [dictionaryTransformer reverseTransformedValue:model];

    if (dict) {
        return @[ dict ];
    }

    return @[];
}];
</code></pre><p>}<br>[/code]</p>
</li>
</ul>
<h3 id="reversibleTransformerWithForwardBlock-reverseBlock"><a href="#reversibleTransformerWithForwardBlock-reverseBlock" class="headerlink" title="reversibleTransformerWithForwardBlock:reverseBlock:"></a>reversibleTransformerWithForwardBlock:reverseBlock:</h3><p>The reversibleTransformerWithForwardBlock is called to convert from JSON to model, and reverseBlock is called to convert model back to JSON</p>
<p>Take a look at this example, it is a value transformer that convert NSNumber to NSString</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(NSValueTransformer <em>)ftg_stringValueTransformer {<br>  NSValueTransformer </em>stringValueTransformer = [MTLValueTransformer</p>
<pre><code>reversibleTransformerWithBlock:^ id (NSNumber *number) {
    if (![number isKindOfClass:NSNumber.class]) {
        return  nil;
    }

    return number.stringValue;
}];
</code></pre><p>  return stringValueTransformer;<br>}<br>[/code]</p>
</li>
</ul>
<p>In the reversibleTransformerWithBlock, the parameter is of kind NSNumber (in JSON dictionary) and the return value is of kind NSString (the property you declare on your model)</p>
<h4 id="transformerWithBlock"><a href="#transformerWithBlock" class="headerlink" title="transformerWithBlock:"></a>transformerWithBlock:</h4><p>If you just need to convert from JSON to model, you can just use transformerWithBlock, which just hav reverseBlock set to nil</p>
<h3 id="How-to-hook-into-Mantle"><a href="#How-to-hook-into-Mantle" class="headerlink" title="How to hook into Mantle"></a>How to hook into Mantle</h3><p>If for some reason, you don’t want to use those value transformer, you can override initWithDictionary method (remember to call super).</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(instancetype)initWithDictionary:(NSDictionary <em>)dictionaryValue error:(NSError *</em>)error {<br>  self = [super initWithDictionary:dictionaryValue error:error];<br>  if (self == nil) return nil;</p>
<p>  // Store a value that needs to be determined locally upon initialization.<br>  _retrievedAt = [NSDate date];</p>
<p>  return self;<br>}<br>[/code]</p>
</li>
</ul>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ol>
<li><a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a></li>
</ol>
<ol>
<li><a href="https://github.com/Mantle/Mantle/issues/350" target="_blank" rel="external">Possible to access first object in nested array ?</a></li>
</ol>
<ol>
<li><a href="https://github.com/onmyway133/FTGValueTransformer" target="_blank" rel="external">FTGValueTransformer</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/23237352/how-to-hook-into-mantle" target="_blank" rel="external">How to hook into Mantle</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/18/understanding-mantle-value-transformer/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/18/understanding-sdwebimage-decompression/" title="Understanding SDWebImage - Decompression" itemprop="url">Understanding SDWebImage - Decompression</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:34:06.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="How-does-UIImage-decompression-happen"><a href="#How-does-UIImage-decompression-happen" class="headerlink" title="How does UIImage decompression happen"></a>How does UIImage decompression happen</h2><p>This is a very good blog post explaining how UIImage decompression work <a href="http://www.cocoanetics.com/2011/10/avoiding-image-decompression-sickness/" target="_blank" rel="external">Avoiding Image Decompression Sickness</a></p>
<blockquote>
<p>This delay results from the fact that images need to be decompressed from their file incarnation to be rendered on screen. Unfortunately UIImage does this decompression at the very latest possible moment, i.e. when it is to be displayed.</p>
</blockquote>
<p>Basically, there are 3 steps</p>
<ul>
<li>Get compressed image data from server (PNG, JPEG, …)</li>
<li>Initialize UIImage with that compressed image data</li>
<li>When that UIImage is about to be shown onto UIImageView, that image data from the UIImage will be decompressed. And that decompressed data is what is displayed on UIImageView</li>
</ul>
<blockquote>
<p>Then there’s the question of “How fast can I get these pixels on screen?”. The answer to this is comprised of 3 main time intervals:</p>
<ul>
<li>time to alloc/init the UIImage with data on disk</li>
<li>time to decompress the bits into an uncompressed format</li>
<li>time to transfer the uncompressed bits to a CGContext, potentially resizing, blending, anti-aliasing it</li>
</ul>
</blockquote>
<h2 id="shouldDecompressImages"><a href="#shouldDecompressImages" class="headerlink" title="shouldDecompressImages"></a>shouldDecompressImages</h2><blockquote>
<p>  Decompressing images that are downloaded and cached can improve performance but can consume lot of memory. Defaults to YES. Set this to NO if you are experiencing a crash due to excessive memory consumption.</p>
</blockquote>
<p>SDWebImage will decompress UIImage when received data from network, or when loaded from disk</p>
<h3 id="SDWebImageDownloaderOperation"><a href="#SDWebImageDownloaderOperation" class="headerlink" title="SDWebImageDownloaderOperation"></a>SDWebImageDownloaderOperation</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">if</span> (partialImageRef) &#123;</span><br><span class="line">                <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:partialImageRef scale:<span class="number">1</span> orientation:orientation];</span><br><span class="line">                <span class="built_in">NSString</span> *key = [[SDWebImageManager sharedManager] cacheKeyForURL:<span class="keyword">self</span>.request.URL];</span><br><span class="line">                <span class="built_in">UIImage</span> *scaledImage = [<span class="keyword">self</span> scaledImageForKey:key image:image];</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDecompressImages) &#123;</span><br><span class="line">                    image = [<span class="built_in">UIImage</span> decodedImageWithImage:scaledImage];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    image = scaledImage;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">                dispatch_main_sync_safe(^&#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">self</span>.completedBlock) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.completedBlock(image, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">NO</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SDImageCache"><a href="#SDImageCache" class="headerlink" title="SDImageCache"></a>SDImageCache</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIImage</span> *)diskImageForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> sd_imageWithData:data];</span><br><span class="line">        image = [<span class="keyword">self</span> scaledImageForKey:key image:image];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDecompressImages) &#123;</span><br><span class="line">            image = [<span class="built_in">UIImage</span> decodedImageWithImage:image];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> image;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Decompression"><a href="#Decompression" class="headerlink" title="Decompression"></a>Decompression</h2><p>The simplest way is to tell UIImage to draw<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)decompressImage:(<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">UIGraphicsBeginImageContext</span>(<span class="built_in">CGSizeMake</span>(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">	[image drawAtPoint:<span class="built_in">CGPointZero</span>];</span><br><span class="line">	<span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>For a more fine tuned approach, see <code>SDWebImageDecoder</code></p>
<h2 id="Where-are-the-decompressed-images"><a href="#Where-are-the-decompressed-images" class="headerlink" title="Where are the decompressed images"></a>Where are the decompressed images</h2><h3 id="UIImage-imageNamed"><a href="#UIImage-imageNamed" class="headerlink" title="[UIImage imageNamed]"></a>[UIImage imageNamed]</h3><blockquote><br>  The biggest thing that +imageNamed: does is decode the image data from the source file, which almost always significantly inflates the data size (for example, a screen sized PNG file might consume a few dozen KBs when compressed, but consumes over half a MB decompressed - width <em> height </em> 4). By contrast +imageWithContentsOfFile: will decompress that image everytime the image data is needed.<br></blockquote>





<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="http://stackoverflow.com/questions/316236/difference-between-uiimage-imagenamed-and-uiimage-imagewithdata" target="_blank" rel="external">Difference between [UIImage imageNamed…] and [UIImage imageWithData…]?</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/10149165/uiimage-decompression-causing-scrolling-lag" target="_blank" rel="external">UIImage decompression causing scrolling lag</a></li>
</ol>
<ol>
<li><a href="https://github.com/rs/SDWebImage/wiki/How-is-SDWebImage-better-than-X%3F" target="_blank" rel="external">How is SDWebImage better than X?</a></li>
</ol>
<ol>
<li><a href="https://github.com/rs/SDWebImage/issues/1173" target="_blank" rel="external">What does SDWebImageDecoder do?</a></li>
</ol>
<ol>
<li><a href="https://github.com/rs/SDWebImage/issues/755" target="_blank" rel="external">Why the image file size is big</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/924740/dispelling-the-uiimage-imagenamed-fud" target="_blank" rel="external">Dispelling the UIImage imageNamed: FUD</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/18/understanding-sdwebimage-decompression/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/18/understanding-afnetworking-error/" title="Understanding AFNetworking - Error" itemprop="url">Understanding AFNetworking - Error</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:33:39.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>When using AFNetworking, I want to get the status code in case of failure</p>
<h2 id="NSError-in-failure-block"><a href="#NSError-in-failure-block" class="headerlink" title="NSError in failure block"></a>NSError in failure block</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line">    [sessionManager GET:<span class="string">@""</span> parameters:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<p>The <code>error.code</code> is not the HTTP status code, it is <code>NSError</code> that AFNetworking creates due to serializer error</p>
<h2 id="How-AFNetworking-creates-NSError"><a href="#How-AFNetworking-creates-NSError" class="headerlink" title="How AFNetworking creates NSError"></a>How AFNetworking creates NSError</h2><h3 id="AFURLSessionManager-m"><a href="#AFURLSessionManager-m" class="headerlink" title="AFURLSessionManager.m"></a>AFURLSessionManager.m</h3><p>In <code>URLSession:task:didCompleteWithError:</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSError</span> *serializationError = <span class="literal">nil</span>;</span><br><span class="line">            responseObject = [manager.responseSerializer responseObjectForResponse:task.response data:[<span class="built_in">NSData</span> dataWithData:<span class="keyword">self</span>.mutableData] error:&amp;serializationError];</span><br></pre></td></tr></table></figure>
<h3 id="AFErrorWithUnderlyingError"><a href="#AFErrorWithUnderlyingError" class="headerlink" title="AFErrorWithUnderlyingError"></a>AFErrorWithUnderlyingError</h3><p>This is called in <code>validateResponse:data:error:</code> and <code>responseObjectForResponse:data:error</code> of  <code>AFURLResponseSerialization</code> classes</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSError</span> * AFErrorWithUnderlyingError(<span class="built_in">NSError</span> *error, <span class="built_in">NSError</span> *underlyingError) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">        <span class="keyword">return</span> underlyingError;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!underlyingError || error.userInfo[<span class="built_in">NSUnderlyingErrorKey</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *mutableUserInfo = [error.userInfo mutableCopy];</span><br><span class="line">    mutableUserInfo[<span class="built_in">NSUnderlyingErrorKey</span>] = underlyingError;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">NSError</span> alloc] initWithDomain:error.domain code:error.code userInfo:mutableUserInfo];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Error-Domain"><a href="#Error-Domain" class="headerlink" title="Error Domain"></a>Error Domain</h3><p>In <code>AFURLResponseSerialization.h</code></p>
<blockquote><br>  Error codes for <code>AFURLResponseSerializationErrorDomain</code> correspond to codes in <code>NSURLErrorDomain</code>.<br></blockquote>



<p>For example<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">validationError = AFErrorWithUnderlyingError([<span class="built_in">NSError</span> errorWithDomain:AFURLResponseSerializationErrorDomain code:<span class="built_in">NSURLErrorCannotDecodeContentData</span> userInfo:mutableUserInfo], validationError);</span><br></pre></td></tr></table></figure></p>
<h2 id="HTTP-Status-code"><a href="#HTTP-Status-code" class="headerlink" title="HTTP Status code"></a>HTTP Status code</h2><h3 id="Inspect-userInfo-of-NSError"><a href="#Inspect-userInfo-of-NSError" class="headerlink" title="Inspect userInfo of NSError"></a>Inspect userInfo of NSError</h3><p>The NSError userInfo contains <code>AFNetworkingOperationFailingURLResponseErrorKey</code> and <code>AFNetworkingOperationFailingURLResponseDataErrorKey</code> that we can inspect to get NSURLResponse and NSData</p>
<h3 id="Replace-NSError"><a href="#Replace-NSError" class="headerlink" title="Replace NSError"></a>Replace NSError</h3><p>Sometimes we don’t care about <code>NSURLErrorDomain</code>, we can get HTTP Status Code from NSURResponse and replace the code in the NSError</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [<span class="keyword">self</span>.manager dataTaskWithRequest:request</span><br><span class="line">                                                     completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> responseObject, <span class="built_in">NSError</span> *error)</span><br><span class="line">                                      &#123;</span><br><span class="line">                                         <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                                             error = [<span class="keyword">self</span> errorFromError:error</span><br><span class="line">                                                           responseObject:responseObject</span><br><span class="line">                                                                 response:response];</span><br><span class="line">                                              [subscriber sendError:error];</span><br><span class="line">                                          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                              [subscriber sendNext:responseObject];</span><br><span class="line">                                              [subscriber sendCompleted];</span><br><span class="line">                                          &#125;</span><br><span class="line">                                      &#125;];</span><br><span class="line">- (<span class="built_in">NSError</span> *)errorFromError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">             responseObject:(<span class="keyword">id</span>)responseObject</span><br><span class="line">                   response:(<span class="built_in">NSURLResponse</span> *)response &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *userInfo = [<span class="built_in">NSMutableDictionary</span> dictionaryWithDictionary:error.userInfo];</span><br><span class="line">    <span class="keyword">if</span> (responseObject) &#123;</span><br><span class="line">        userInfo[kNetworkProviderResponseObjectKey] = responseObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSInteger</span> HTTPStatusCode = error.code;</span><br><span class="line">    <span class="keyword">if</span> (response) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([response isKindOfClass:[<span class="built_in">NSHTTPURLResponse</span> class]]) &#123;</span><br><span class="line">            <span class="built_in">NSHTTPURLResponse</span> *HTTPResponse = (<span class="keyword">id</span>)response;</span><br><span class="line">            HTTPStatusCode = HTTPResponse.statusCode;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        HTTPStatusCode = <span class="number">408</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSError</span> errorWithDomain:error.domain code:HTTPStatusCode userInfo:userInfo];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="http://www.osstatus.com/" target="_blank" rel="external">OSStatus</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/18/understanding-afnetworking-error/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/18/understanding-afnetworking-block/" title="Understanding AFNetworking - Block" itemprop="url">Understanding AFNetworking - Block</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:31:04.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Hi, in this AFNetworking gotcha series, I’ll share something I learn about AFNetworking and remind you of some properties you may overlook</p>
        
        
        <p class="article-more-link">
          
            <a href="/blog/2015/06/18/understanding-afnetworking-block/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/18/understanding-afnetworking-block/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/18/understanding-afnetworking-operation/" title="Understanding AFNetworking - Operation" itemprop="url">Understanding AFNetworking - Operation</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:30:27.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Hi, in this AFNetworking gotcha series, I’ll share something I learn about AFNetworking and remind you of some properties you may overlook</p>
<h4 id="AFHTTPRequestOperation-is-an-NSOperation"><a href="#AFHTTPRequestOperation-is-an-NSOperation" class="headerlink" title="AFHTTPRequestOperation is an NSOperation"></a>AFHTTPRequestOperation is an NSOperation</h4><p>Take a look at AFURLConnectionOperation.m and its overridden “start” method, you ‘ll learn how AFNetworking starts an NSURLConnection. The same holds true for NSURLSession</p>
        
        
        <p class="article-more-link">
          
            <a href="/blog/2015/06/18/understanding-afnetworking-operation/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/18/understanding-afnetworking-operation/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/06/18/understanding-afnetworking-cache/" title="Understanding AFNetworking - Cache" itemprop="url">Understanding AFNetworking - Cache</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:29:19.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h2><p>I’m talking about <code>AFHTTPSessionManager</code>, but the same applies to <code>AFHTTPRequestOperationManager</code>. AFNetworking is just a wrapper around <code>AFURLSession</code> and <code>AFURLConnection</code>, and uses <code>NSURLCache</code> to make caching happen</p>
<h3 id="Does-AFNetworking-cache"><a href="#Does-AFNetworking-cache" class="headerlink" title="Does AFNetworking cache"></a>Does AFNetworking cache</h3><p>AFNetworking only uses NSCache for caching images, as implemented in AFImageCache. Read more <a href="http://blog.originate.com/blog/2014/02/20/afimagecache-vs-nsurlcache/" target="_blank" rel="external">How Does Caching Work in AFNetworking? : AFImageCache &amp; NSUrlCache Explained</a></p>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p>We often usage <code>AFHTTPSessionManager</code> like this<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AFHTTPSessionManager manager]</span><br></pre></td></tr></table></figure></p>
<p>Which is using default session configuration<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)initWithSessionConfiguration:(<span class="built_in">NSURLSessionConfiguration</span> *)configuration &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!configuration) &#123;</span><br><span class="line">        configuration = [<span class="built_in">NSURLSessionConfiguration</span> defaultSessionConfiguration];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.sessionConfiguration = configuration;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="NSURLSessionConfiguration"><a href="#NSURLSessionConfiguration" class="headerlink" title="NSURLSessionConfiguration"></a>NSURLSessionConfiguration</h3><p>The <code>defaultSessionConfiguration</code> has 2 cache properties</p>
<h4 id="URLCache"><a href="#URLCache" class="headerlink" title="URLCache"></a>URLCache</h4><blockquote><br>  The URL cache for providing cached responses to requests within the session.<br><br>  This property determines the URL cache object used by tasks within sessions based on this configuration.<br>  To disable caching, set this property to nil.<br>  For default sessions, the default value is the shared URL cache object.<br>  For background sessions, the default value is nil.<br>  For ephemeral sessions, the default value is a private cache object that stores data in memory only, and is destroyed when you invalidate the session.<br></blockquote>





<h4 id="requestCachePolicy"><a href="#requestCachePolicy" class="headerlink" title="requestCachePolicy"></a>requestCachePolicy</h4><blockquote><br>  A predefined constant that determines when to return a response from the cache.<br><br>  This property determines the request caching policy used by tasks within sessions based on this configuration.<br>  Set this property to one of the constants defined in NSURLRequestCachePolicy to specify whether the cache policy should depend on expiration dates and age, whether the cache should be disabled entirely, and whether the server should be contacted to determine if the content has changed since it was last requested.<br>  The default value is NSURLRequestUseProtocolCachePolicy.<br></blockquote>





<h3 id="dataTaskWillCacheResponse"><a href="#dataTaskWillCacheResponse" class="headerlink" title="dataTaskWillCacheResponse"></a>dataTaskWillCacheResponse</h3><blockquote><br>  Sets a block to be executed to determine the caching behavior of a data task<br></blockquote>



<p>AFNetworking uses this block as a chance to us to intercept to the response</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session</span><br><span class="line">          dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask</span><br><span class="line"> willCacheResponse:(<span class="built_in">NSCachedURLResponse</span> *)proposedResponse</span><br><span class="line"> completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSCachedURLResponse</span> *cachedResponse))completionHandler</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSCachedURLResponse</span> *cachedResponse = proposedResponse;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.dataTaskWillCacheResponse) &#123;</span><br><span class="line">        cachedResponse = <span class="keyword">self</span>.dataTaskWillCacheResponse(session, dataTask, proposedResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (completionHandler) &#123;</span><br><span class="line">        completionHandler(cachedResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Reading <code>URLSession:dataTask:willCacheResponse:completionHandler</code> tells us that</p>
<blockquote><br>  The session calls this delegate method after the task finishes receiving all of the expected data. If you do not implement this method, the default behavior is to use the caching policy specified in the session’s configuration object. The primary purpose of this method is to prevent caching of specific URLs or to modify the userInfo dictionary associated with the URL response.<br><br>  The session calls this delegate method after the task finishes receiving all of the expected data. If you do not implement this method, the default behavior is to use the caching policy specified in the session’s configuration object. The primary purpose of this method is to prevent caching of specific URLs or to modify the userInfo dictionary associated with the URL response.<br>  - This method is called only if the NSURLProtocol handling the request decides to cache the response. As a rule, responses are cached only when all of the following are true:<br>  - The request is for an HTTP or HTTPS URL (or your own custom networking protocol that supports caching).<br>  - The request was successful (with a status code in the 200–299 range).<br>  - The provided response came from the server, rather than out of the cache.<br>  - The session configuration’s cache policy allows caching.<br>  - The provided NSURLRequest object’s cache policy (if applicable) allows caching.<br>  - The cache-related headers in the server’s response (if present) allow caching.<br>  - The response size is small enough to reasonably fit within the cache. (For example, if you provide a disk cache, the response must be no larger than about 5% of the disk cache size.)<br></blockquote>





<h3 id="How-to-prevent-caching"><a href="#How-to-prevent-caching" class="headerlink" title="How to prevent caching"></a>How to prevent caching</h3><p>We can prevent caching by either</p>
<ol>
<li>Implement <code>dataTaskWillCacheResponse</code> and return nil</li>
<li>Set <code>requestCachePolicy</code> to <code>NSURLRequestReloadIgnoringLocalCacheData</code><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line">sessionManager.session.configuration.requestCachePolicy = <span class="built_in">NSURLRequestReloadIgnoringLocalCacheData</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Note that <code>NSURLRequestReloadIgnoringLocalAndRemoteCacheData</code> is not implemented by the OS, and <code>NSURLRequestReloadIgnoringCacheData</code> is just synonym for <code>NSURLRequestReloadIgnoringLocalCacheData</code></p>
<ol>
<li><p>Set <code>URLCache</code> to nil</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line">sessionManager.session.configuration.URLCache = <span class="literal">nil</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>NSURLRequest cachePolicy<br>NSURLRequest has <code>cachePolicy</code> that can be used to control caching for specific request</p>
</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165-BCICJDHA" target="_blank" rel="external">URL Loading System Programming Guide</a></li>
</ol>
<ol>
<li><a href="http://www.raywenderlich.com/59982/nsurlprotocol-tutorial" target="_blank" rel="external">NSURLProtocol Tutorial</a></li>
</ol>
<ol>
<li><a href="http://catthoughts.ghost.io/in-depth-nsurlcache/" target="_blank" rel="external">NSURLCACHE &amp; NSCACHED URLRESPONSE</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/12180727/afnetworking-how-to-know-if-response-is-using-cache-or-not-304-or-200" target="_blank" rel="external">AFNetworking : How to know if response is using cache or not ? 304 or 200</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/25586244/afnetworking-2-0-forced-caching" target="_blank" rel="external">AFNetworking 2.0 - Forced caching</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/24328461/how-to-disable-caching-from-nsurlsessiontask" target="_blank" rel="external">How to disable caching from NSURLSessionTask</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/24281331/afnetworking-different-cache-settings-for-different-content" target="_blank" rel="external">AFNetworking different cache settings for different content</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/20768968/why-is-nsurlsession-dont-use-my-configured-nsurlcache" target="_blank" rel="external">Why is NSURLSession don’t use my configured NSURLCache?</a></li>
</ol>
<ol>
<li><a href="http://nshipster.com/nsurlcache/" target="_blank" rel="external">NSURLCache</a></li>
</ol>
<ol>
<li><a href="https://blackpixel.com/writing/2012/05/caching-and-nsurlconnection.html" target="_blank" rel="external">Caching and NSURLConnection</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/06/18/understanding-afnetworking-cache/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/04/18/opportunities/" title="Opportunities" itemprop="url">Opportunities</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-04-18T02:35:55.000Z" itemprop="datePublished"> Published 2015-04-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>I read in <a href="http://blog.penso.info/2013/05/25/getting-a-job-in-san-francisco/" target="_blank" rel="external">an article</a> that “Working in fashion? Go to NYC. Working in Software development? Go to SF. It’s just that simple.”. By SF or other high tech scene places, I mean we can have opportunities to learn in the best universities, work with the best people, meet new friends in local meet ups, conferences, …</p>
<p>I see questions on Quora a lot on how to relocate to work in those companies, how to have eligible visa to attend bootcamp, conferences, …</p>
<p>But think for a while now, we already have access to all these things by other means, to a certain degree even if we ‘re not in the Bay Area. All we need is the the right attitude. So be positive and do <a href="http://blog.codinghorror.com/the-ultimate-code-kata/" target="_blank" rel="external">effortful study</a>. The world is more likely to be flat now</p>
<ul>
<li>University: We can learn course from <a href="https://www.edx.org" target="_blank" rel="external">edX</a>, <a href="https://www.coursera.org/" target="_blank" rel="external">Coursera</a>, <a href="https://www.udacity.com" target="_blank" rel="external">Udacity</a>, …</li>
</ul>
<ul>
<li>Meet up: Some meet up talks push their presentations on Slideshare, SpeakerDeck</li>
</ul>
<ul>
<li>Conference: Some conferences (WWDC, Google IO, …) provide streaming and archived videos</li>
</ul>
<ul>
<li>Book: We can buy and read the same books. <a href="http://www.fantageek.com/1631/recommended-books-for-developers/">Recommended books for developers</a></li>
</ul>
<ul>
<li>Bootcamp: Some like <a href="https://www.bloc.io/" target="_blank" rel="external">Bloc</a>, … have their bootcamp program available online</li>
</ul>
<ul>
<li>Chat room: Most of the chat rooms (Stackoverflow Chat, IRC, Gitter, …) are public</li>
</ul>
<ul>
<li>Tech talk, Web Seminar: Most allow us to join (Raywenderlich Tech Talk, SenchaTouch web seminar, …) on Google Hangout, …</li>
</ul>
<ul>
<li>Work: Some companies allow remote work and the trend is increasing. <a href="https://www.youtube.com/watch?v=m6yCKoSetW8" target="_blank" rel="external">What Remote Working Means &amp; The Tools We Use - Buffer’s Founder Chat Friday</a></li>
</ul>
<ul>
<li>Projects: We can learn and contribute to open source projects. Some companies like <a href="http://www.objc.io/issue-22/artsy.html" target="_blank" rel="external">Artsy</a> have “Open Source By default” in mind, and we can learn much from their work</li>
</ul>
<ul>
<li>Blog: Popular developers have blog. You can learn a lot by reading their blogs. <a href="http://www.quora.com/What-are-the-most-popular-software-developer-blogs-news-sources" target="_blank" rel="external">What are the most popular software developer blogs/news sources?</a></li>
</ul>
<ul>
<li>Trend: Twitter is a good source for learning new trends in the community. And following popular people cost you zero</li>
</ul>
<ul>
<li>Network: You can connect with awesome people on Linkedin and share experience about your professional subjects</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Programming/">Programming</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/04/18/opportunities/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2015/04/10/ios-asynchrony/" title="iOS Asynchrony" itemprop="url">iOS Asynchrony</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-04-10T01:30:41.000Z" itemprop="datePublished"> Published 2015-04-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a><a href="https://developer.apple.com/library/prerelease/mac/documentation/Performance/Reference/GCD_libdispatch_Ref/index.html" target="_blank" rel="external">GCD</a></h3><blockquote><br>  Grand Central Dispatch (GCD) comprises language features, runtime libraries, and system enhancements that provide systemic, comprehensive improvements to the support for concurrent code execution on multicore hardware in iOS and OS X.<br></blockquote>



<p>[code language=”objc”]<br>// Doing something on the main thread</p>
<p>dispatch_queue_t myQueue = dispatch_queue_create(“My Queue”,NULL);<br>dispatch_async(myQueue, ^{<br>    // Perform long running process</p>
<pre><code>dispatch_async(dispatch_get_main_queue(), ^{
    // Update the UI

});
</code></pre><p>}); </p>
<p>// Continue doing other stuff on the<br>// main thread while process is running.<br>[/code]</p>
<h3 id="PromiseKit"><a href="#PromiseKit" class="headerlink" title="PromiseKit"></a><a href="https://github.com/mxcl/PromiseKit" target="_blank" rel="external">PromiseKit</a></h3><blockquote><br>  A promise is an object that wraps an asynchronous task. Pass that object around, and write clean, ordered code; a logical, simple, modular stream of progression from one asynchronous task to another.<br></blockquote>



<p>[code language=”objc”]<br>[self login].then(^{</p>
<pre><code>// our login method wrapped an async task in a promise
return [API fetchKittens];
</code></pre><p>}).then(^(NSArray *fetchedKittens){</p>
<pre><code>// our API class wraps our API and returns promises
// fetchKittens returned a promise that resolves with an array of kittens
self.kittens = fetchedKittens;
[self.tableView reloadData];
</code></pre><p>}).catch(^(NSError *error){</p>
<pre><code>// any errors in any of the above promises land here
[[[UIAlertView alloc] init…] show];
</code></pre><p>});<br>[/code]</p>
<h3 id="Bolt"><a href="#Bolt" class="headerlink" title="Bolt"></a><a href="https://github.com/BoltsFramework/Bolts-iOS" target="_blank" rel="external">Bolt</a></h3><blockquote><br>  A task represents the result of an asynchronous operation. Typically, a BFTask is returned from an asynchronous function and gives the ability to continue processing the result of the task. When a task is returned from a function, it’s already begun doing its job.<br><br>  A task is not tied to a particular threading model: it represents the work being done, not where it is executing.<br></blockquote>



<p>[code language=”objc”]<br>[[self saveAsync:obj] continueWithBlock:^id(BFTask <em>task) {<br>  if (task.isCancelled) {<br>    // the save was cancelled.<br>  } else if (task.error) {<br>    // the save failed.<br>  } else {<br>    // the object was saved successfully.<br>    PFObject </em>object = task.result;<br>  }<br>  return nil;<br>}];<br>[/code]</p>
<h3 id="ReactiveCocoa"><a href="#ReactiveCocoa" class="headerlink" title="ReactiveCocoa"></a><a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">ReactiveCocoa</a></h3><blockquote><br>  ReactiveCocoa (RAC) is an Objective-C framework inspired by Functional Reactive Programming. It provides APIs for composing and transforming streams of values.<br><br>  Rather than using mutable variables which are replaced and modified in-place, RAC provides signals (represented by RACSignal) that capture present and future values.<br><br>  By chaining, combining, and reacting to signals, software can be written declaratively, without the need for code that continually observes and updates values.<br></blockquote>



<p>[code language=”objc”]<br>[[[[client<br>    logInUser]<br>    flattenMap:^(User <em>user) {<br>        // Return a signal that loads cached messages for the user.<br>        return [client loadCachedMessagesForUser:user];<br>    }]<br>    flattenMap:^(NSArray </em>messages) {<br>        // Return a signal that fetches any remaining messages.<br>        return [client fetchMessagesAfterMessage:messages.lastObject];<br>    }]<br>    subscribeNext:^(NSArray *newMessages) {<br>        NSLog(@”New messages: %@”, newMessages);<br>    } completed:^{<br>        NSLog(@”Fetched all messages.”);<br>    }];<br>[/code]</p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ol>
<li><a href="http://www.dimroc.com/2014/12/17/bolt-framework-promisekit-or-reactive-cocoa-for-async/" target="_blank" rel="external">Taming Callbacks in iOS: Bolts Framework</a></li>
</ol>
<ol>
<li><a href="http://jeffreysambells.com/2013/03/01/asynchronous-operations-in-ios-with-grand-central-dispatch" target="_blank" rel="external">Asynchronous Operations in iOS with Grand Central Dispatch</a></li>
</ol>
<ol>
<li><a href="http://sapandiwakar.in/promisekit-promises-for-ios/" target="_blank" rel="external">PromiseKit: Promises for iOS</a></li>
</ol>
<ol>
<li><a href="http://www.fantageek.com/1649/recommended-resources-for-learning-reactivecocoa-2/">Recommended resources for learning ReactiveCocoa</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/blog/2015/04/10/ios-asynchrony/#disqus_thread" class="comments-count-link">Comments</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/5/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/7/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="onmyway133" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Script/" title="Java Script">Java Script<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Life/" title="Life">Life<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Miscellaneous/" title="Miscellaneous">Miscellaneous<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mobile-Labs/" title="Mobile Labs">Mobile Labs<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/" title="Others">Others<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming/" title="Programming">Programming<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/Windows-8/" title="Windows 8">Windows 8<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/" title="Windows 8">Windows 8<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-Phone/" title="Windows Phone">Windows Phone<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/Windows-Phone/" title="Windows Phone">Windows Phone<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>85</sup></a></li>
		  
		
		  
			<li><a href="/categories/programming/" title="programming">programming<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/ios/" title="ios">ios<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/wp7/" title="wp7">wp7<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/mac-osx/" title="mac osx">mac osx<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/tutorial/" title="tutorial">tutorial<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/wp8/" title="wp8">wp8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C">C<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/windows-8/" title="windows 8">windows 8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/convert/" title="convert">convert<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/project/" title="project">project<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/disable/" title="disable">disable<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/build/" title="build">build<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/programming/" title="programming">programming<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/svn/" title="svn">svn<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/openssl/" title="openssl">openssl<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/xcode/" title="xcode">xcode<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/view-controller/" title="view controller">view controller<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/file/" title="file">file<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/facebook/" title="facebook">facebook<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/voip/" title="voip">voip<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> A dream is not a dream anymore when you don&#39;t have time for it <br/>
			What you don&#39;t know is what you haven&#39;t learned</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/onmyway133" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/1418457/onmyway133" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/onmyway133" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		
		
		
		
		
		<a href="mailto:onmyway133@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Khoa Pham">Khoa Pham</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-40119591-1', 'fantageek.com');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
