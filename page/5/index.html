
 <!DOCTYPE HTML>
<html lang="English">
<head>
  <meta charset="UTF-8">
  
    <title>Fantageek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Khoa Pham">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Fantageek">
<meta property="og:url" content="http://www.fantageek.com/page/5/index.html">
<meta property="og:site_name" content="Fantageek">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fantageek">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="Fantageek" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Fantageek" title="Fantageek"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Fantageek">Fantageek</a></h1>
				<h2 class="blog-motto">Simple apps that make sense</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:www.fantageek.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/08/understanding-libextobjc/" title="Understanding libextobjc" itemprop="url">Understanding libextobjc</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-07-08T15:22:35.000Z" itemprop="datePublished"> Published 2015-07-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="https://github.com/jspahrsummers/libextobjc" target="_blank" rel="external">libextobjc</a></p>
<blockquote><br>  A Cocoa library to extend the Objective-C programming language.<br></blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/04/ios-configuration/" title="iOS configuration" itemprop="url">iOS configuration</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-07-04T02:19:32.000Z" itemprop="datePublished"> Published 2015-07-04</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>This is about creating multiple targets from a project.</p>
<h3 id="Source-file"><a href="#Source-file" class="headerlink" title="Source file"></a>Source file</h3><p>Source files (.m, .plist, …) must be checked into appropriate target</p>
<h3 id="Info-plist"><a href="#Info-plist" class="headerlink" title="Info.plist"></a>Info.plist</h3><p>Each target should have its own Info.plist. Info.plist should not be checked into the target. Otherwise, you will get a warning</p>
<blockquote><br>  The Copy Bundle Resources build phase contains this target’s Info.plist file<br></blockquote>



<p>Instead, it must be specified in the target ‘s <code>Build Setting -&gt; Packaging -&gt; Info.plist file</code>. It can be absolute or relative to the project file</p>
<h3 id="Entitlement"><a href="#Entitlement" class="headerlink" title="Entitlement"></a>Entitlement</h3><p>Entitlement should not be checked into the target</p>
<p>Instead, it must be specified in the target ‘s <code>Build Setting -&gt; Code Signing -&gt; Code Signing Entitlement</code>. Ut can be absolute or relative to the project file</p>
<h3 id="Asset-Catalog"><a href="#Asset-Catalog" class="headerlink" title="Asset Catalog"></a>Asset Catalog</h3><p>Asset Catalog must be checked into the appropriate target. The fix for multiple target with multiple Asset Catalog together with Cocoapods is <a href="https://github.com/2359media/ios-dev-discussions/issues/7" target="_blank" rel="external">Multiple targets and Asset Catalog with Cocoapods</a></p>
<h3 id="Read-Build-Setting-Reference"><a href="#Read-Build-Setting-Reference" class="headerlink" title="Read Build Setting Reference"></a>Read Build Setting Reference</h3><p><a href="https://developer.apple.com/library/mac/documentation/DeveloperTools/Reference/XcodeBuildSettingRef/1-Build_Setting_Reference/build_setting_ref.html" target="_blank" rel="external">Build Setting Reference</a> has some predefined macros that can be useful.</p>
<h3 id="Preprocessor-Macro"><a href="#Preprocessor-Macro" class="headerlink" title="Preprocessor Macro"></a>Preprocessor Macro</h3><p>Under target <code>Build Setting -&gt; Apple LLVM Preprocessing -&gt; Preprocessor Macros</code>, we can define our own macro, which can be useful in code.</p>
<p>For example, in Distro A target, I can set macro DISTRO_A to both Debug and Release Configuration.</p>
<h3 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h3><p>Multiple targets can have different configuration (server path, Facebook ID, …). This can be achieved by several ways</p>
<h4 id="ifdef"><a href="#ifdef" class="headerlink" title="ifdef"></a>ifdef</h4><p>[code lang=text]</p>
<p>#ifdef DISTRO_A<br>NSString *serverPath = @”<a href="http://distro-a.com" target="_blank" rel="external">http://distro-a.com</a>“;</p>
<p>#else<br>NSString *serverPath = @”<a href="http://distro-b.com" target="_blank" rel="external">http://distro-b.com</a>“;</p>
<p>#endif<br>[/code]</p>
<h4 id="1-config-h-file-and-multiple-config-m-file-for-each-target"><a href="#1-config-h-file-and-multiple-config-m-file-for-each-target" class="headerlink" title="1 config.h file and multiple config.m file for each target"></a>1 config.h file and multiple config.m file for each target</h4><p><code>Config.h</code></p>
<p>[code lang=text]<br>extern NSString *serverPath;<br>[/code]</p>
<p><code>Config.m</code> (Distro A target)</p>
<p>[code lang=text]<br>NSString *serverPath = @”<a href="http://distro-a.com" target="_blank" rel="external">http://distro-a.com</a>“;<br>[/code]</p>
<p><code>Config.m</code> (Distro B target)</p>
<p>[code lang=text]<br>NSString *serverPath = @”<a href="http://distro-b.com" target="_blank" rel="external">http://distro-b.com</a>“;<br>[/code]</p>
<h4 id="Protocol-and-Abstract-Factory"><a href="#Protocol-and-Abstract-Factory" class="headerlink" title="Protocol and Abstract Factory"></a>Protocol and Abstract Factory</h4><p>We can define a protocol<br><code>Config.h</code><br>[code language=”objc”]<br>@protocol Config <nsobject></nsobject></p>
<ul>
<li>(NSString *)serverPath;</li>
</ul>
<p>@end<br>[/code]</p>
<p><code>DistroAConfig.h</code><br>[code language=”objc”]<br>@interface DistroAConfig : NSObject <config></config></p>
<p>@end<br>[/code]</p>
<p><code>DistroAConfig.m</code><br>[code language=”objc”]<br>@implementation DistroAConfig</p>
<ul>
<li>(NSString *)serverPath {<br>  return @”<a href="http://distro-a.com" target="_blank" rel="external">http://distro-a.com</a>“;<br>}</li>
</ul>
<p>@end<br>[/code]</p>
<h3 id="Theme"><a href="#Theme" class="headerlink" title="Theme"></a>Theme</h3><p>Each target can have different themes (different color, font, text size, spacing, …). We can use protocol together with Abstract Factory pattern. Each target has a ThemeFactory that can produces HomeTheme, SettingTheme, AboutTheme, FavoriteTheme, … This way you only need to use <code>ifdef</code> once</p>
<p><code>Theme.h</code><br>[code language=”objc”]<br>id<themefactory> themeFactory();<br>[/code]</themefactory></p>
<p><code>Theme.m</code><br>[code language=”objc”]<br>id<themefactory> themeFactory() {</themefactory></p>
<p>#ifdef DISTRO_A<br>    return [DistroAHomeThemeFactory new];</p>
<p>#else<br>    return [DistroBThemeFactory new];</p>
<p>#endif<br>}<br>[/code]</p>
<p><code>ThemeFactory.h</code><br>[code language=”objc”]<br>@protocol ThemeFactory <nsobject></nsobject></p>
<ul>
<li>(id<hometheme>)home;</hometheme></li>
</ul>
<p>@end<br>[/code]</p>
<p><code>HomeTheme.h</code><br>[code language=”objc”]<br>@protocol HomeTheme <nsobject></nsobject></p>
<ul>
<li>(UIColor *)titleColor;</li>
<li>(UIFont *)titleFont;</li>
</ul>
<p>@end<br>[/code]</p>
<p><code>DistroAThemeFactory.h</code><br>[code language=”objc”]<br>@interface DistroAThemeFactory : NSObject <themefactory><br>@end<br>[/code]</themefactory></p>
<p><code>DistroAThemeFactory.m</code><br>[code language=”objc”]<br>@implementation DistroAThemeFactory</p>
<ul>
<li>(id<hometheme>)home {<br>  return [DistroAHomeTheme new];<br>}</hometheme></li>
</ul>
<p>@end<br>[/code]</p>
<p><code>DistroAHomeTheme.h</code><br>[code language=”objc”]<br>@interface DistroAHomeTheme : NSObject <hometheme></hometheme></p>
<p>@end<br>[/code]</p>
<p><code>DistroAHomeTheme.m</code><br>[code language=”objc”]<br>@implementation DistroAHomeTheme</p>
<ul>
<li><p>(UIColor *)titleColor {<br>  return [UIColor redColor];<br>}</p>
</li>
<li><p>(UIFont *)titleFont {<br>  return [UIFont boldSystemFontOfSize:15];<br>}</p>
</li>
</ul>
<p>@end<br>[/code]</p>
<p><code>HomeViewController.m</code><br>[code language=”objc”]</p>
<p>#import “Theme.h”</p>
<p>self.label.textColor = themeFactory().home.titleColor;<br>[/code]</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://samwize.com/2014/05/22/create-multiple-targets-slash-apps-for-1-xcode-project/" target="_blank" rel="external">Create Multiple Targets/Apps for 1 Xcode Project</a></li>
</ul>
<ul>
<li><a href="http://lowlevelbits.org/yaml-based-configuration-for-objc-projects/" target="_blank" rel="external">YAML-based Configuration for ObjC Projects</a></li>
</ul>
<ul>
<li><a href="http://ilya.puchka.me/info-plist-preprocessing/" target="_blank" rel="external">Info.plist preprocessing</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/28/understanding-pstalertcontroller-weaksheetstorage/" title="Understanding PSTAlertController - weakSheetStorage" itemprop="url">Understanding PSTAlertController - weakSheetStorage</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-28T13:43:50.000Z" itemprop="datePublished"> Published 2015-06-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>For those who don’t use <a href="https://github.com/steipete/PSTAlertController" target="_blank" rel="external">PSTAlertController</a></p>
<blockquote><br>  API similar to UIAlertController, backwards compatible to iOS 7. Will use the new shiny API when you run iOS 8.<br></blockquote>



<p>The thing I find interesting about it is its dance for <code>weakSheetStorage</code> and <code>strongSheetStorage</code><br>Read <a href="https://github.com/steipete/PSTAlertController/issues/3" target="_blank" rel="external">Understand strongSheetStorage vs weakSheetStorage</a></p>
<blockquote><br>  It’s for exact object lifecycle management. The controller isn’t retained but needs to stick around, and once show is called we bind the lifetime to the views presented, so everything is cleaned up at the correct time without worrying about manually retaining things.<br></blockquote>





<h2 id="Init"><a href="#Init" class="headerlink" title="Init"></a>Init</h2><p>When PSTAlertController is initialized, it hold a strong reference to UIAlertView and UIActionSheet<br>[code language=”objc”]<br>if (preferredStyle == PSTAlertControllerStyleActionSheet) {<br>                _strongSheetStorage = [[UIActionSheet alloc] initWithTitle:title delegate:self cancelButtonTitle:nil destructiveButtonTitle:nil otherButtonTitles:nil];<br>            } else {<br>                _strongSheetStorage = [[UIAlertView alloc] initWithTitle:title message:message delegate:self cancelButtonTitle:nil otherButtonTitles:nil];<br>            }<br>[/code]</p>
<h2 id="Show"><a href="#Show" class="headerlink" title="Show"></a>Show</h2><p>PSTAlertController may not be kept by any object, but the system keeps UIAlertView and UIActionSheet, so when UIAlertView and UIActionSheet is shown, we attach PSTAlertController to these<br>[code language=”objc”]</p>
<ul>
<li><p>(void)moveSheetToWeakStorage {<br>  NSParameterAssert(self.strongSheetStorage);</p>
<p>  objc_setAssociatedObject(self.strongSheetStorage, _cmd, self, OBJC_ASSOCIATION_RETAIN_NONATOMIC); // bind lifetime<br>  self.weakSheetStorage = self.strongSheetStorage;<br>  self.strongSheetStorage = nil;<br>}<br>[/code]</p>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/28/understanding-flex-orientation/" title="Understanding FLEX - Orientation" itemprop="url">Understanding FLEX - Orientation</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-28T13:28:44.000Z" itemprop="datePublished"> Published 2015-06-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>FLEX ‘s bar always follow the orientation of your app. To do that, FLEX custom UIWindow ‘s rootViewController must ask your app for orientation and status bar style</p>
<h3 id="FLEXExplorerViewController-m"><a href="#FLEXExplorerViewController-m" class="headerlink" title="FLEXExplorerViewController.m"></a>FLEXExplorerViewController.m</h3><p>This is the core method, it finds the correct viewController to ask<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Try to get the preferred status bar properties from the app's root view controller (not us).</span></span><br><span class="line"><span class="comment">// In general, our window shouldn't be the key window when this view controller is asked about the status bar.</span></span><br><span class="line"><span class="comment">// However, we guard against infinite recursion and provide a reasonable default for status bar behavior in case our window is the keyWindow.</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIViewController</span> *)viewControllerForStatusBarAndOrientationProperties</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIViewController</span> *viewControllerToAsk = [[[<span class="built_in">UIApplication</span> sharedApplication] keyWindow] rootViewController];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// On iPhone, modal view controllers get asked</span></span><br><span class="line">    <span class="keyword">if</span> ([[<span class="built_in">UIDevice</span> currentDevice] userInterfaceIdiom] == <span class="built_in">UIUserInterfaceIdiomPhone</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (viewControllerToAsk.presentedViewController) &#123;</span><br><span class="line">            viewControllerToAsk = viewControllerToAsk.presentedViewController;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> viewControllerToAsk;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>For orientation, it simply asks the found viewController</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSUInteger</span>)supportedInterfaceOrientations</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIViewController</span> *viewControllerToAsk = [<span class="keyword">self</span> viewControllerForStatusBarAndOrientationProperties];</span><br><span class="line">    <span class="built_in">NSUInteger</span> supportedOrientations = [FLEXUtility infoPlistSupportedInterfaceOrientationsMask];</span><br><span class="line">    <span class="keyword">if</span> (viewControllerToAsk &amp;&amp; viewControllerToAsk != <span class="keyword">self</span>) &#123;</span><br><span class="line">        supportedOrientations = [viewControllerToAsk supportedInterfaceOrientations];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The UIViewController docs state that this method must not return zero.</span></span><br><span class="line">    <span class="comment">// If we weren't able to get a valid value for the supported interface orientations, default to all supported.</span></span><br><span class="line">    <span class="keyword">if</span> (supportedOrientations == <span class="number">0</span>) &#123;</span><br><span class="line">        supportedOrientations = <span class="built_in">UIInterfaceOrientationMaskAll</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> supportedOrientations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/flipboard/flex" target="_blank" rel="external">FLEX</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/28/understanding-flex-hit-testing/" title="Understanding FLEX - Hit testing" itemprop="url">Understanding FLEX - Hit testing</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-28T13:25:04.000Z" itemprop="datePublished"> Published 2015-06-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>We can’t touch through FLEX ‘s bar to its underneath content. It’s a good thing to learn</p>
<h3 id="FLEXWindow-m"><a href="#FLEXWindow-m" class="headerlink" title="FLEXWindow.m"></a>FLEXWindow.m</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)pointInside:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">BOOL</span> pointInside = <span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.eventDelegate shouldHandleTouchAtPoint:point]) &#123;</span><br><span class="line">        pointInside = [<span class="keyword">super</span> pointInside:point withEvent:event];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pointInside;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FLEXManager-m"><a href="#FLEXManager-m" class="headerlink" title="FLEXManager.m"></a>FLEXManager.m</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)shouldHandleTouchAtPoint:(<span class="built_in">CGPoint</span>)pointInWindow</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Ask the explorer view controller</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span>.explorerViewController shouldReceiveTouchAtWindowPoint:pointInWindow];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FLEXExplorerViewController-m"><a href="#FLEXExplorerViewController-m" class="headerlink" title="FLEXExplorerViewController.m"></a>FLEXExplorerViewController.m</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)shouldReceiveTouchAtWindowPoint:(<span class="built_in">CGPoint</span>)pointInWindowCoordinates</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">BOOL</span> shouldReceiveTouch = <span class="literal">NO</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CGPoint</span> pointInLocalCoordinates = [<span class="keyword">self</span>.view convertPoint:pointInWindowCoordinates fromView:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Always if it's on the toolbar</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CGRectContainsPoint</span>(<span class="keyword">self</span>.explorerToolbar.frame, pointInLocalCoordinates)) &#123;</span><br><span class="line">        shouldReceiveTouch = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Always if we're in selection mode</span></span><br><span class="line">    <span class="keyword">if</span> (!shouldReceiveTouch &amp;&amp; <span class="keyword">self</span>.currentMode == FLEXExplorerModeSelect) &#123;</span><br><span class="line">        shouldReceiveTouch = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Always in move mode too</span></span><br><span class="line">    <span class="keyword">if</span> (!shouldReceiveTouch &amp;&amp; <span class="keyword">self</span>.currentMode == FLEXExplorerModeMove) &#123;</span><br><span class="line">        shouldReceiveTouch = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Always if we have a modal presented</span></span><br><span class="line">    <span class="keyword">if</span> (!shouldReceiveTouch &amp;&amp; <span class="keyword">self</span>.presentedViewController) &#123;</span><br><span class="line">        shouldReceiveTouch = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> shouldReceiveTouch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/flipboard/flex" target="_blank" rel="external">FLEX</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/28/understanding-sdwebimage-clean/" title="Understanding SDWebImage - Clean" itemprop="url">Understanding SDWebImage - Clean</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-28T13:20:11.000Z" itemprop="datePublished"> Published 2015-06-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="clearDisk"><a href="#clearDisk" class="headerlink" title="clearDisk"></a>clearDisk</h2><p>Erase all files on disk cache. In <code>SDImageCache.m</code><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)clearDiskOnCompletion:(SDWebImageNoParamsBlock)completion</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">        [_fileManager removeItemAtPath:<span class="keyword">self</span>.diskCachePath error:<span class="literal">nil</span>];</span><br><span class="line">        [_fileManager createDirectoryAtPath:<span class="keyword">self</span>.diskCachePath</span><br><span class="line">                withIntermediateDirectories:<span class="literal">YES</span></span><br><span class="line">                                 attributes:<span class="literal">nil</span></span><br><span class="line">                                      error:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (completion) &#123;</span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                completion();</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="cleanDisk"><a href="#cleanDisk" class="headerlink" title="cleanDisk"></a>cleanDisk</h2><p>Erase some files based on cache time and cache size<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock &#123;</span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">   <span class="comment">// Erase old files</span></span><br><span class="line">   <span class="built_in">NSDate</span> *expirationDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:-<span class="keyword">self</span>.maxCacheAge];</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> *cacheFiles = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="built_in">NSUInteger</span> currentCacheSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Enumerate all of the files in the cache directory.  This loop has two purposes:</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">//  1. Removing files that are older than the expiration date.</span></span><br><span class="line">        <span class="comment">//  2. Storing file attributes for the size-based cleanup pass.</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> *urlsToDelete = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// Erase more until cache size is preservered</span></span><br><span class="line">    <span class="comment">// If our remaining disk cache exceeds a configured maximum size, perform a second</span></span><br><span class="line">        <span class="comment">// size-based cleanup pass.  We delete the oldest files first.</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.maxCacheSize &gt; <span class="number">0</span> &amp;&amp; currentCacheSize &gt; <span class="keyword">self</span>.maxCacheSize) &#123;</span><br><span class="line">            <span class="comment">// Target half of our maximum cache size for this cleanup pass.</span></span><br><span class="line">            <span class="keyword">const</span> <span class="built_in">NSUInteger</span> desiredCacheSize = <span class="keyword">self</span>.maxCacheSize / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/18/understanding-sdwebimage-cache/" title="Understanding SDWebImage - Cache" itemprop="url">Understanding SDWebImage - Cache</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T15:26:48.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>SDWebImage stores UIImage in <code>memCache</code> first, then into disk. UIImage gets compressed to <code>NSData</code> before going to disk<br>In <code>SDImageCache.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image recalculateFromImage:(<span class="built_in">BOOL</span>)recalculate imageData:(<span class="built_in">NSData</span> *)imageData forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk &#123;</span><br><span class="line">    <span class="keyword">if</span> (!image || !key) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span>.memCache setObject:image forKey:key cost:image.size.height * image.size.width * image.scale * image.scale];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (toDisk) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (imageIsPng) &#123;</span><br><span class="line">                    data = <span class="built_in">UIImagePNGRepresentation</span>(image);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    data = <span class="built_in">UIImageJPEGRepresentation</span>(image, (<span class="built_in">CGFloat</span>)<span class="number">1.0</span>);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">                data = [<span class="built_in">NSBitmapImageRep</span> representationOfImageRepsInArray:image.representations usingType: <span class="built_in">NSJPEGFileType</span> properties:<span class="literal">nil</span>];</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                <span class="keyword">if</span> (![_fileManager fileExistsAtPath:_diskCachePath]) &#123;</span><br><span class="line">                    [_fileManager createDirectoryAtPath:_diskCachePath withIntermediateDirectories:<span class="literal">YES</span> attributes:<span class="literal">nil</span> error:<span class="literal">NULL</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                [_fileManager createFileAtPath:[<span class="keyword">self</span> defaultCachePathForKey:key] contents:data attributes:<span class="literal">nil</span>];</span><br><span class="line">            &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that <code>NSFileManager</code> <code>createFileAtPath:contents:data:attributes:nil:</code> returns NO if the write operation fails. This includes not enough disk space. See <a href="http://stackoverflow.com/a/7618759/1418457" target="_blank" rel="external">detect no disk space iPhone SDK</a></p>
<h2 id="Retrieval"><a href="#Retrieval" class="headerlink" title="Retrieval"></a>Retrieval</h2><p>SDWebImage will first check to see if the images are in local before going to make network request<br>In <code>SDImageCache.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSOperation</span> *)queryDiskCacheForKey:(<span class="built_in">NSString</span> *)key done:(SDWebImageQueryCompletedBlock)doneBlock &#123;</span><br><span class="line">    <span class="keyword">if</span> (!doneBlock) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">        doneBlock(<span class="literal">nil</span>, SDImageCacheTypeNone);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// First check the in-memory cache...</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="keyword">self</span> imageFromMemoryCacheForKey:key];</span><br><span class="line">    <span class="keyword">if</span> (image) &#123;</span><br><span class="line">        doneBlock(image, SDImageCacheTypeMemory);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSOperation</span> *operation = [<span class="built_in">NSOperation</span> new];</span><br><span class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.ioQueue, ^&#123;</span><br><span class="line">        <span class="keyword">if</span> (operation.isCancelled) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">            <span class="built_in">UIImage</span> *diskImage = [<span class="keyword">self</span> diskImageForKey:key];</span><br><span class="line">            <span class="keyword">if</span> (diskImage) &#123;</span><br><span class="line">                <span class="built_in">CGFloat</span> cost = diskImage.size.height * diskImage.size.width * diskImage.scale * diskImage.scale;</span><br><span class="line">                [<span class="keyword">self</span>.memCache setObject:diskImage forKey:key cost:cost];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                doneBlock(diskImage, SDImageCacheTypeDisk);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="How-UIImage-is-created"><a href="#How-UIImage-is-created" class="headerlink" title="How UIImage is created"></a>How UIImage is created</h2><p>SDWebImage uses <code>SDWebImageDownloaderOperation</code> and <code>NSURLConnection</code> to kick off network requests.<br>UIImage is created by a call to <code>sd_imageWithData:</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">UIImage</span> *)sd_imageWithData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    <span class="built_in">UIImage</span> *image;</span><br><span class="line">    <span class="built_in">NSString</span> *imageContentType = [<span class="built_in">NSData</span> sd_contentTypeForImageData:data];</span><br><span class="line">    <span class="keyword">if</span> ([imageContentType isEqualToString:<span class="string">@"image/gif"</span>]) &#123;</span><br><span class="line">        image = [<span class="built_in">UIImage</span> sd_animatedGIFWithData:data];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#ifdef SD_WEBP</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([imageContentType isEqualToString:<span class="string">@"image/webp"</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        image = [<span class="built_in">UIImage</span> sd_imageWithWebPData:data];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        image = [[<span class="built_in">UIImage</span> alloc] initWithData:data];</span><br><span class="line">        <span class="built_in">UIImageOrientation</span> orientation = [<span class="keyword">self</span> sd_imageOrientationFromImageData:data];</span><br><span class="line">        <span class="keyword">if</span> (orientation != <span class="built_in">UIImageOrientationUp</span>) &#123;</span><br><span class="line">            image = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:image.CGImage</span><br><span class="line">                                        scale:image.scale</span><br><span class="line">                                  orientation:orientation];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Use-another-SDImageCache"><a href="#Use-another-SDImageCache" class="headerlink" title="Use another SDImageCache"></a>Use another SDImageCache</h2><p>From <a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a>,</p>
<blockquote><br>  It is also possible to use the async based image cache store independently. SDImageCache maintains a memory cache and an optional disk cache. Disk cache write operations are performed asynchronous so it doesn’t add unnecessary latency to the UI.<br>  The SDImageCache class provides a singleton instance for convenience but you can create your own instance if you want to create separated cache namespace<br></blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/18/understanding-mantle-value-transformer/" title="Understanding Mantle - Value Transformer" itemprop="url">Understanding Mantle - Value Transformer</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:34:53.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Mantle is my number 1 choice for the model class. It has a lot of predefined value transformers, you can take a look at NSValueTransformer+MTLInversionAdditions and NSValueTransformer+MTLPredefinedTransformerAdditions.</p>
<h3 id="Predefined-value-transformer"><a href="#Predefined-value-transformer" class="headerlink" title="Predefined value transformer"></a>Predefined value transformer</h3><p>Currently Mantle 1.5 supports these value transformers</p>
<p>mtl_invertedTransformer<br>mtl_JSONDictionaryTransformerWithModelClass<br>mtl_JSONArrayTransformerWithModelClass<br>mtl_valueMappingTransformerWithDictionary<br>URLValueTransformer<br>booleanValueTransformer</p>
<p>The transformer without parameters (like URLValueTransformer and booleanValueTransformer are registered with NSValueTransformer in the “load” method</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(void)load {<br>  @autoreleasepool {</p>
<pre><code>MTLValueTransformer *URLValueTransformer = [MTLValueTransformer
    reversibleTransformerWithForwardBlock:^ id (NSString *str) {
        if (![str isKindOfClass:NSString.class]) return nil;
        return [NSURL URLWithString:str];
    }
    reverseBlock:^ id (NSURL *URL) {
        if (![URL isKindOfClass:NSURL.class]) return nil;
        return URL.absoluteString;
    }];

[NSValueTransformer setValueTransformer:URLValueTransformer forName:MTLURLValueTransformerName];

MTLValueTransformer *booleanValueTransformer = [MTLValueTransformer
    reversibleTransformerWithBlock:^ id (NSNumber *boolean) {
        if (![boolean isKindOfClass:NSNumber.class]) return nil;
        return (NSNumber *)(boolean.boolValue ? kCFBooleanTrue : kCFBooleanFalse);
    }];

[NSValueTransformer setValueTransformer:booleanValueTransformer forName:MTLBooleanValueTransformerName];
</code></pre><p>  }<br>}<br>[/code]</p>
</li>
</ul>
<p>But eventually, those transformers end up calling reversibleTransformerWithForwardBlock:reverseBlock: and the real converter is the MTLJSONAdapter</p>
<h3 id="Custom-value-transformer"><a href="#Custom-value-transformer" class="headerlink" title="Custom value transformer"></a>Custom value transformer</h3><p>If those value transformer do not suit your need. You can learn from what Mantle already does, and build your own value transformer</p>
<p>For example, this is a custom value transformer from my FTGValueTransformer that converts the first object in a JSON array to a model</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(NSValueTransformer <em>)ftg_JSONFirstObjectInArrayTransformerWithModelClass:(Class)modelClass {<br>  NSValueTransformer </em>dictionaryTransformer = [self mtl_JSONDictionaryTransformerWithModelClass:modelClass];</p>
<p>  return [MTLValueTransformer</p>
<pre><code>reversibleTransformerWithForwardBlock:^ id (NSArray *dictionaries) {
    if (dictionaries == nil || dictionaries.count == 0) {
        return nil;
    }

    NSAssert([dictionaries isKindOfClass:NSArray.class], @&quot;Expected a array of dictionaries, got: %@&quot;, dictionaries);

    NSDictionary *firstDictionary = [dictionaries firstObject];

    NSAssert([firstDictionary isKindOfClass:NSDictionary.class], @&quot;Expected a dictionary or an NSNull, got: %@&quot;, firstDictionary);

    id model = [dictionaryTransformer transformedValue:firstDictionary];

    return model;
}
reverseBlock:^ id (id model) {
    if (model == nil) {
        return nil;
    }

    NSAssert([model isKindOfClass:MTLModel.class], @&quot;Expected an MTLModel or an NSNull, got: %@&quot;, model);

    NSDictionary *dict = [dictionaryTransformer reverseTransformedValue:model];

    if (dict) {
        return @[ dict ];
    }

    return @[];
}];
</code></pre><p>}<br>[/code]</p>
</li>
</ul>
<h3 id="reversibleTransformerWithForwardBlock-reverseBlock"><a href="#reversibleTransformerWithForwardBlock-reverseBlock" class="headerlink" title="reversibleTransformerWithForwardBlock:reverseBlock:"></a>reversibleTransformerWithForwardBlock:reverseBlock:</h3><p>The reversibleTransformerWithForwardBlock is called to convert from JSON to model, and reverseBlock is called to convert model back to JSON</p>
<p>Take a look at this example, it is a value transformer that convert NSNumber to NSString</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(NSValueTransformer <em>)ftg_stringValueTransformer {<br>  NSValueTransformer </em>stringValueTransformer = [MTLValueTransformer</p>
<pre><code>reversibleTransformerWithBlock:^ id (NSNumber *number) {
    if (![number isKindOfClass:NSNumber.class]) {
        return  nil;
    }

    return number.stringValue;
}];
</code></pre><p>  return stringValueTransformer;<br>}<br>[/code]</p>
</li>
</ul>
<p>In the reversibleTransformerWithBlock, the parameter is of kind NSNumber (in JSON dictionary) and the return value is of kind NSString (the property you declare on your model)</p>
<h4 id="transformerWithBlock"><a href="#transformerWithBlock" class="headerlink" title="transformerWithBlock:"></a>transformerWithBlock:</h4><p>If you just need to convert from JSON to model, you can just use transformerWithBlock, which just hav reverseBlock set to nil</p>
<h3 id="How-to-hook-into-Mantle"><a href="#How-to-hook-into-Mantle" class="headerlink" title="How to hook into Mantle"></a>How to hook into Mantle</h3><p>If for some reason, you don’t want to use those value transformer, you can override initWithDictionary method (remember to call super).</p>
<p>[code language=”objc”]</p>
<ul>
<li><p>(instancetype)initWithDictionary:(NSDictionary <em>)dictionaryValue error:(NSError *</em>)error {<br>  self = [super initWithDictionary:dictionaryValue error:error];<br>  if (self == nil) return nil;</p>
<p>  // Store a value that needs to be determined locally upon initialization.<br>  _retrievedAt = [NSDate date];</p>
<p>  return self;<br>}<br>[/code]</p>
</li>
</ul>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ol>
<li><a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a></li>
</ol>
<ol>
<li><a href="https://github.com/Mantle/Mantle/issues/350" target="_blank" rel="external">Possible to access first object in nested array ?</a></li>
</ol>
<ol>
<li><a href="https://github.com/onmyway133/FTGValueTransformer" target="_blank" rel="external">FTGValueTransformer</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/23237352/how-to-hook-into-mantle" target="_blank" rel="external">How to hook into Mantle</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/18/understanding-sdwebimage-decompression/" title="Understanding SDWebImage - Decompression" itemprop="url">Understanding SDWebImage - Decompression</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:34:06.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="How-does-UIImage-decompression-happen"><a href="#How-does-UIImage-decompression-happen" class="headerlink" title="How does UIImage decompression happen"></a>How does UIImage decompression happen</h2><p>This is a very good blog post explaining how UIImage decompression work <a href="http://www.cocoanetics.com/2011/10/avoiding-image-decompression-sickness/" target="_blank" rel="external">Avoiding Image Decompression Sickness</a></p>
<blockquote>
<p>This delay results from the fact that images need to be decompressed from their file incarnation to be rendered on screen. Unfortunately UIImage does this decompression at the very latest possible moment, i.e. when it is to be displayed.</p>
</blockquote>
<p>Basically, there are 3 steps</p>
<ul>
<li>Get compressed image data from server (PNG, JPEG, …)</li>
<li>Initialize UIImage with that compressed image data</li>
<li>When that UIImage is about to be shown onto UIImageView, that image data from the UIImage will be decompressed. And that decompressed data is what is displayed on UIImageView</li>
</ul>
<blockquote>
<p>Then there’s the question of “How fast can I get these pixels on screen?”. The answer to this is comprised of 3 main time intervals:</p>
<ul>
<li>time to alloc/init the UIImage with data on disk</li>
<li>time to decompress the bits into an uncompressed format</li>
<li>time to transfer the uncompressed bits to a CGContext, potentially resizing, blending, anti-aliasing it</li>
</ul>
</blockquote>
<h2 id="shouldDecompressImages"><a href="#shouldDecompressImages" class="headerlink" title="shouldDecompressImages"></a>shouldDecompressImages</h2><blockquote>
<p>  Decompressing images that are downloaded and cached can improve performance but can consume lot of memory. Defaults to YES. Set this to NO if you are experiencing a crash due to excessive memory consumption.</p>
</blockquote>
<p>SDWebImage will decompress UIImage when received data from network, or when loaded from disk</p>
<h3 id="SDWebImageDownloaderOperation"><a href="#SDWebImageDownloaderOperation" class="headerlink" title="SDWebImageDownloaderOperation"></a>SDWebImageDownloaderOperation</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)connection:(<span class="built_in">NSURLConnection</span> *)connection didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">if</span> (partialImageRef) &#123;</span><br><span class="line">                <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:partialImageRef scale:<span class="number">1</span> orientation:orientation];</span><br><span class="line">                <span class="built_in">NSString</span> *key = [[SDWebImageManager sharedManager] cacheKeyForURL:<span class="keyword">self</span>.request.URL];</span><br><span class="line">                <span class="built_in">UIImage</span> *scaledImage = [<span class="keyword">self</span> scaledImageForKey:key image:image];</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDecompressImages) &#123;</span><br><span class="line">                    image = [<span class="built_in">UIImage</span> decodedImageWithImage:scaledImage];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    image = scaledImage;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">                dispatch_main_sync_safe(^&#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">self</span>.completedBlock) &#123;</span><br><span class="line">                        <span class="keyword">self</span>.completedBlock(image, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">NO</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SDImageCache"><a href="#SDImageCache" class="headerlink" title="SDImageCache"></a>SDImageCache</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIImage</span> *)diskImageForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">        <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> sd_imageWithData:data];</span><br><span class="line">        image = [<span class="keyword">self</span> scaledImageForKey:key image:image];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.shouldDecompressImages) &#123;</span><br><span class="line">            image = [<span class="built_in">UIImage</span> decodedImageWithImage:image];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> image;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Decompression"><a href="#Decompression" class="headerlink" title="Decompression"></a>Decompression</h2><p>The simplest way is to tell UIImage to draw<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)decompressImage:(<span class="built_in">UIImage</span> *)image</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">UIGraphicsBeginImageContext</span>(<span class="built_in">CGSizeMake</span>(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">	[image drawAtPoint:<span class="built_in">CGPointZero</span>];</span><br><span class="line">	<span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>For a more fine tuned approach, see <code>SDWebImageDecoder</code></p>
<h2 id="Where-are-the-decompressed-images"><a href="#Where-are-the-decompressed-images" class="headerlink" title="Where are the decompressed images"></a>Where are the decompressed images</h2><h3 id="UIImage-imageNamed"><a href="#UIImage-imageNamed" class="headerlink" title="[UIImage imageNamed]"></a>[UIImage imageNamed]</h3><blockquote><br>  The biggest thing that +imageNamed: does is decode the image data from the source file, which almost always significantly inflates the data size (for example, a screen sized PNG file might consume a few dozen KBs when compressed, but consumes over half a MB decompressed - width <em> height </em> 4). By contrast +imageWithContentsOfFile: will decompress that image everytime the image data is needed.<br></blockquote>





<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="http://stackoverflow.com/questions/316236/difference-between-uiimage-imagenamed-and-uiimage-imagewithdata" target="_blank" rel="external">Difference between [UIImage imageNamed…] and [UIImage imageWithData…]?</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/10149165/uiimage-decompression-causing-scrolling-lag" target="_blank" rel="external">UIImage decompression causing scrolling lag</a></li>
</ol>
<ol>
<li><a href="https://github.com/rs/SDWebImage/wiki/How-is-SDWebImage-better-than-X%3F" target="_blank" rel="external">How is SDWebImage better than X?</a></li>
</ol>
<ol>
<li><a href="https://github.com/rs/SDWebImage/issues/1173" target="_blank" rel="external">What does SDWebImageDecoder do?</a></li>
</ol>
<ol>
<li><a href="https://github.com/rs/SDWebImage/issues/755" target="_blank" rel="external">Why the image file size is big</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/924740/dispelling-the-uiimage-imagenamed-fud" target="_blank" rel="external">Dispelling the UIImage imageNamed: FUD</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/06/18/understanding-afnetworking-error/" title="Understanding AFNetworking - Error" itemprop="url">Understanding AFNetworking - Error</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2015-06-18T14:33:39.000Z" itemprop="datePublished"> Published 2015-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>When using AFNetworking, I want to get the status code in case of failure</p>
<h2 id="NSError-in-failure-block"><a href="#NSError-in-failure-block" class="headerlink" title="NSError in failure block"></a>NSError in failure block</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line">    [sessionManager GET:<span class="string">@""</span> parameters:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="keyword">id</span> responseObject) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> *task, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, error);</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<p>The <code>error.code</code> is not the HTTP status code, it is <code>NSError</code> that AFNetworking creates due to serializer error</p>
<h2 id="How-AFNetworking-creates-NSError"><a href="#How-AFNetworking-creates-NSError" class="headerlink" title="How AFNetworking creates NSError"></a>How AFNetworking creates NSError</h2><h3 id="AFURLSessionManager-m"><a href="#AFURLSessionManager-m" class="headerlink" title="AFURLSessionManager.m"></a>AFURLSessionManager.m</h3><p>In <code>URLSession:task:didCompleteWithError:</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSError</span> *serializationError = <span class="literal">nil</span>;</span><br><span class="line">            responseObject = [manager.responseSerializer responseObjectForResponse:task.response data:[<span class="built_in">NSData</span> dataWithData:<span class="keyword">self</span>.mutableData] error:&amp;serializationError];</span><br></pre></td></tr></table></figure>
<h3 id="AFErrorWithUnderlyingError"><a href="#AFErrorWithUnderlyingError" class="headerlink" title="AFErrorWithUnderlyingError"></a>AFErrorWithUnderlyingError</h3><p>This is called in <code>validateResponse:data:error:</code> and <code>responseObjectForResponse:data:error</code> of  <code>AFURLResponseSerialization</code> classes</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSError</span> * AFErrorWithUnderlyingError(<span class="built_in">NSError</span> *error, <span class="built_in">NSError</span> *underlyingError) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error) &#123;</span><br><span class="line">        <span class="keyword">return</span> underlyingError;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!underlyingError || error.userInfo[<span class="built_in">NSUnderlyingErrorKey</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *mutableUserInfo = [error.userInfo mutableCopy];</span><br><span class="line">    mutableUserInfo[<span class="built_in">NSUnderlyingErrorKey</span>] = underlyingError;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">NSError</span> alloc] initWithDomain:error.domain code:error.code userInfo:mutableUserInfo];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Error-Domain"><a href="#Error-Domain" class="headerlink" title="Error Domain"></a>Error Domain</h3><p>In <code>AFURLResponseSerialization.h</code></p>
<blockquote><br>  Error codes for <code>AFURLResponseSerializationErrorDomain</code> correspond to codes in <code>NSURLErrorDomain</code>.<br></blockquote>



<p>For example<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">validationError = AFErrorWithUnderlyingError([<span class="built_in">NSError</span> errorWithDomain:AFURLResponseSerializationErrorDomain code:<span class="built_in">NSURLErrorCannotDecodeContentData</span> userInfo:mutableUserInfo], validationError);</span><br></pre></td></tr></table></figure></p>
<h2 id="HTTP-Status-code"><a href="#HTTP-Status-code" class="headerlink" title="HTTP Status code"></a>HTTP Status code</h2><h3 id="Inspect-userInfo-of-NSError"><a href="#Inspect-userInfo-of-NSError" class="headerlink" title="Inspect userInfo of NSError"></a>Inspect userInfo of NSError</h3><p>The NSError userInfo contains <code>AFNetworkingOperationFailingURLResponseErrorKey</code> and <code>AFNetworkingOperationFailingURLResponseDataErrorKey</code> that we can inspect to get NSURLResponse and NSData</p>
<h3 id="Replace-NSError"><a href="#Replace-NSError" class="headerlink" title="Replace NSError"></a>Replace NSError</h3><p>Sometimes we don’t care about <code>NSURLErrorDomain</code>, we can get HTTP Status Code from NSURResponse and replace the code in the NSError</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURLSessionDataTask</span> *task = [<span class="keyword">self</span>.manager dataTaskWithRequest:request</span><br><span class="line">                                                     completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="keyword">id</span> responseObject, <span class="built_in">NSError</span> *error)</span><br><span class="line">                                      &#123;</span><br><span class="line">                                         <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                                             error = [<span class="keyword">self</span> errorFromError:error</span><br><span class="line">                                                           responseObject:responseObject</span><br><span class="line">                                                                 response:response];</span><br><span class="line">                                              [subscriber sendError:error];</span><br><span class="line">                                          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                              [subscriber sendNext:responseObject];</span><br><span class="line">                                              [subscriber sendCompleted];</span><br><span class="line">                                          &#125;</span><br><span class="line">                                      &#125;];</span><br><span class="line">- (<span class="built_in">NSError</span> *)errorFromError:(<span class="built_in">NSError</span> *)error</span><br><span class="line">             responseObject:(<span class="keyword">id</span>)responseObject</span><br><span class="line">                   response:(<span class="built_in">NSURLResponse</span> *)response &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *userInfo = [<span class="built_in">NSMutableDictionary</span> dictionaryWithDictionary:error.userInfo];</span><br><span class="line">    <span class="keyword">if</span> (responseObject) &#123;</span><br><span class="line">        userInfo[kNetworkProviderResponseObjectKey] = responseObject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSInteger</span> HTTPStatusCode = error.code;</span><br><span class="line">    <span class="keyword">if</span> (response) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([response isKindOfClass:[<span class="built_in">NSHTTPURLResponse</span> class]]) &#123;</span><br><span class="line">            <span class="built_in">NSHTTPURLResponse</span> *HTTPResponse = (<span class="keyword">id</span>)response;</span><br><span class="line">            HTTPStatusCode = HTTPResponse.statusCode;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        HTTPStatusCode = <span class="number">408</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSError</span> errorWithDomain:error.domain code:HTTPStatusCode userInfo:userInfo];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="http://www.osstatus.com/" target="_blank" rel="external">OSStatus</a></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/4/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/6/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Script/" title="Java Script">Java Script<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Life/" title="Life">Life<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Miscellaneous/" title="Miscellaneous">Miscellaneous<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mobile-Labs/" title="Mobile Labs">Mobile Labs<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/" title="Others">Others<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming/" title="Programming">Programming<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/Windows-8/" title="Windows 8">Windows 8<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/" title="Windows 8">Windows 8<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-Phone/" title="Windows Phone">Windows Phone<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/Windows-Phone/" title="Windows Phone">Windows Phone<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>84</sup></a></li>
		  
		
		  
			<li><a href="/categories/programming/" title="programming">programming<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/ios/" title="ios">ios<sup>20</sup></a></li>
			
		
			
				<li><a href="/tags/wp7/" title="wp7">wp7<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/mac-osx/" title="mac osx">mac osx<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/tutorial/" title="tutorial">tutorial<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/wp8/" title="wp8">wp8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C">C<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/windows-8/" title="windows 8">windows 8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/convert/" title="convert">convert<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/visual-studio/" title="visual studio">visual studio<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/disable/" title="disable">disable<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/build/" title="build">build<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/svn/" title="svn">svn<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/file/" title="file">file<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/openssl/" title="openssl">openssl<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/xcode/" title="xcode">xcode<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/programming/" title="programming">programming<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/facebook/" title="facebook">facebook<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/voip/" title="voip">voip<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/project/" title="project">project<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Larry Page in Google. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Khoa Pham">Khoa Pham</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
