
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>Using Parse SDK with Mantle | Fantageek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Khoa Pham">
    

    
    <meta name="description" content="I’m using Parse SDK and it works great. We can also subclass Parse for more convenience, but I just don’t want to depend much on Parse, so I use Mantle as my model, instead of PFObject.
ModelHere is m">
<meta property="og:type" content="article">
<meta property="og:title" content="Using Parse SDK with Mantle">
<meta property="og:url" content="http://www.fantageek.com/blog/2014/12/19/using-parse-sdk-with-mantle/index.html">
<meta property="og:site_name" content="Fantageek">
<meta property="og:description" content="I’m using Parse SDK and it works great. We can also subclass Parse for more convenience, but I just don’t want to depend much on Parse, so I use Mantle as my model, instead of PFObject.
ModelHere is m">
<meta property="og:updated_time" content="2016-04-14T19:30:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Using Parse SDK with Mantle">
<meta name="twitter:description" content="I’m using Parse SDK and it works great. We can also subclass Parse for more convenience, but I just don’t want to depend much on Parse, so I use Mantle as my model, instead of PFObject.
ModelHere is m">
<meta name="twitter:creator" content="@onmyway133">

    
    <link rel="alternative" href="/atom.xml" title="Fantageek" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="Fantageek" title="Fantageek"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Fantageek">Fantageek</a></h1>
				<h2 class="blog-motto">Simple apps that make sense</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:www.fantageek.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2014/12/19/using-parse-sdk-with-mantle/" title="Using Parse SDK with Mantle" itemprop="url">Using Parse SDK with Mantle</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Khoa Pham" target="_blank" itemprop="author">Khoa Pham</a>
		
  <p class="article-time">
    <time datetime="2014-12-19T04:15:26.000Z" itemprop="datePublished"> Published 2014-12-19</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Model"><span class="toc-number">1.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Treat-PFObject-as-JSON-dictionary"><span class="toc-number">2.</span> <span class="toc-text">Treat PFObject as JSON dictionary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Treat-Parse-network-API-as-network-layer"><span class="toc-number">3.</span> <span class="toc-text">Treat Parse network API as network layer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#We-store-FTGBaseObject-ourselves"><span class="toc-number">4.</span> <span class="toc-text">We store FTGBaseObject ourselves</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parse-Local-Datastore"><span class="toc-number">5.</span> <span class="toc-text">Parse Local Datastore</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">6.</span> <span class="toc-text">Reference</span></a></li></ol>
		
		</div>
		
		<p>I’m using Parse SDK and it works great. We can also subclass Parse for more convenience, but I just don’t want to depend much on Parse, so I use Mantle as my model, instead of PFObject.</p>
<h2 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h2><p>Here is my base model object</p>
<p><code>FTGBaseObject.h</code><br>[code language=”objc”]<br>@interface FTGBaseObject : MTLModel <mtljsonserializing></mtljsonserializing></p>
<p>@property (nonatomic, copy) NSString <em>pfObjectID;<br>@property (nonatomic, strong) NSDate </em>createdAt;<br>@property (nonatomic, strong) NSDate *updatedAt;</p>
<p>@end<br>[/code]</p>
<p><code>FTGBaseObject.m</code><br>[code language=”objc”]<br>@implementation FTGBaseObject</p>
<ul>
<li>(NSDictionary *)JSONKeyPathsByPropertyKey {<br>  return @{<pre><code>@&quot;pfObjectID&quot;: NSNull.null,
@&quot;createdAt&quot;: NSNull.null,
@&quot;updatedAt&quot;: NSNull.null,
};
</code></pre>}</li>
</ul>
<p>#pragma mark - Creation</p>
<ul>
<li><p>(instancetype)objectWithPFObject:(PFObject <em>)pfObject<br>{<br>  FTGBaseObject </em>object = [[self alloc] init];<br>  [object updateWithPFObject:pfObject];<br>  return object;<br>}</p>
</li>
<li><p>(NSArray <em>)objectsWithPFObjects:(NSArray </em>)pfObjects<br>{<br>  NSMutableArray <em>results = [NSMutableArray array];<br>  for (PFObject </em>pfObject in pfObjects) {</p>
<pre><code>FTGBaseObject *object = [[self class] objectWithPFObject:pfObject];
[results addObject:object];
</code></pre><p>  }</p>
<p>  return results;<br>}</p>
</li>
</ul>
<ul>
<li><p>(void)updateWithPFObject:(PFObject *)pfObject<br>{<br>  if (pfObject) {</p>
<pre><code>// TODO: Need to check for pfObject isDataAvailable?
[self updateWithDictionary:pfObject.ftg_toDictionary];
[self updateWithCorePFObject:pfObject];
</code></pre><p>  }<br>}</p>
</li>
<li><p>(void)updateWithDictionary:(NSDictionary *)dictionary<br>{<br>  if (dictionary.count &gt; 0) {</p>
<pre><code>FTGBaseObject *updatedObject = [MTLJSONAdapter modelOfClass:[self class]
                                        fromJSONDictionary:dictionary
                                                     error:nil];
// This is a method to make mergeValuesForKeysFromModel to not update nil values
[self ftg_mergeValuesForKeysFromModel:updatedObject];
</code></pre><p>  }<br>}</p>
</li>
<li><p>(void)updateWithCorePFObject:(PFObject *)pfObject<br>{<br>  self.pfObjectID = pfObject.objectId;<br>  self.updatedAt = pfObject.updatedAt;<br>  self.createdAt = pfObject.createdAt;<br>}</p>
</li>
</ul>
<ul>
<li><p>(NSDictionary *)toJSONDictionary<br>{<br>  return [MTLJSONAdapter JSONDictionaryFromModel:self].ftg_dictionaryByRemovingNull;<br>}</p>
</li>
<li><p>(PFObject *)pfObject<br>{<br>  if (self.pfObjectID) {</p>
<pre><code>PFObject *pfObject = [PFObject objectWithoutDataWithClassName:self.pfObjectClassName objectId:self.pfObjectID];
return pfObject;
</code></pre><p>  }</p>
<p>  return nil;<br>}</p>
</li>
<li><p>(PFObject <em>)toPFObject<br>{<br>  PFObject </em>pfObject = self.pfObject;</p>
<p>  if (!pfObject) {</p>
<pre><code>pfObject = [PFObject objectWithClassName:self.pfObjectClassName dictionary:nil];
</code></pre><p>  }</p>
<p>  [pfObject ftg_updateWithDictionary:self.toJSONDictionary];<br>  return pfObject;<br>}</p>
</li>
</ul>
<ul>
<li>(NSString *)pfObjectClassName<br>{<br>  return nil;<br>}</li>
</ul>
<ul>
<li>(NSString *)pfObjectClassName<br>{<br>  return [[self class] pfObjectClassName];<br>}</li>
</ul>
<p>@end<br>[/code]</p>
<p><code>PFObject+FTGAdditions</code><br>[code language=”objc”]</p>
<ul>
<li><p>(NSDictionary <em>)ftg_toDictionary<br>{<br>  NSMutableDictionary </em>result = [NSMutableDictionary dictionary];<br>  for (NSString *key in self.allKeys) {</p>
<pre><code>[result setObject:self[key] forKey:key];
</code></pre><p>  }</p>
<p>  return result;<br>}</p>
</li>
<li><p>(void)ftg_updateWithDictionary:(NSDictionary <em>)dictionary<br>{<br>  for (NSString </em>key in dictionary.allKeys) {</p>
<pre><code>id value = dictionary[key];
[self setObject:value forKey:key];
</code></pre><p>  }<br>}<br>[/code]</p>
</li>
</ul>
<h2 id="Treat-PFObject-as-JSON-dictionary"><a href="#Treat-PFObject-as-JSON-dictionary" class="headerlink" title="Treat PFObject as JSON dictionary"></a>Treat PFObject as JSON dictionary</h2><p>In the FTGBaseObject above, we can see that PFObject is treated as JSON dictionary, just as a JSON dictionary you normally get from RESTful APIs</p>
<p>For example to map from PFUser to our FTGUser object,<br>[code language=”objc”]</p>
<p>@implementation FTGUser</p>
<ul>
<li><p>(NSDictionary *)JSONKeyPathsByPropertyKey {<br>  return @{@”username”: @”username”,</p>
<pre><code>@&quot;firstName&quot;: @&quot;first_name&quot;,
@&quot;location&quot;: @&quot;location&quot;,
};
</code></pre><p>}</p>
</li>
<li><p>(NSString *)pfObjectClassName<br>{<br>  // PFUser is stored in Parse as _User<br>  return @”_User”;<br>}</p>
</li>
<li><p>(NSValueTransformer <em>)locationJSONTransformer {<br>  return [MTLValueTransformer reversibleTransformerWithForwardBlock:^id(PFObject </em>pfObject) {</p>
<pre><code>return [FTGLocation objectWithPFObject:pfObject];
</code></pre><p>  } reverseBlock:^id(FTGLocation *object) {</p>
<pre><code>return [object toPFObject];
</code></pre><p>  }];<br>}<br>@end<br>[/code]</p>
</li>
</ul>
<p>Notice how our FTGUser object properties use camelCase while PFUser columns is stored as dash_case.</p>
<p>[code language=”objc”]</p>
<p>PFQuery <em>query = [PFQuery queryWithClassName:@”_User”];<br>[query whereKey:@”first_name” equalTo:@”Steven”];<br>PFObject</em> pfObject = [query findObjects].firstObject;<br>FTGUser *user = [FTGUser objectWithPFObject:pfObject];</p>
<p>[/code]</p>
<h2 id="Treat-Parse-network-API-as-network-layer"><a href="#Treat-Parse-network-API-as-network-layer" class="headerlink" title="Treat Parse network API as network layer"></a>Treat Parse network API as network layer</h2><p>You can wrap Parse APIs like <code>PFQuery</code>, <code>saveInBackgroundWithBlock</code>, … in the network layer, just like how you use AFNetworking in your network layer.</p>
<p>Notice the FTGBaseObject, it does not hold any reference to the PFObject as we treat PFObject as JSON dictionary, its mainly usage is the dictionary to update our FTGBaseObject.</p>
<p>FTGBaseObject keeps pfObjectID, and uses this pfObjectID to populate an empty PFObject through the <code>pfObject</code> method. For example when user updates his first name, we just need</p>
<p>[code language=”objc”]</p>
<p>FTGUser <em>user; // Suppose got this before<br>PFObject </em>pfObject = [user pfObject]; // I prefer using dot notation :] like user.pfObject<br>pfObject[@”first_name”] = @”Steven”;<br>[pfObject saveInBackgroundWithBlock:^(BOOL succeeded, NSError *error) {<br>   [user updateWithPFObject:pfObject];<br>}</p>
<p>[/code]</p>
<p>For best practice, we should not call <code>saveInBackgroundWithBlock</code> directly like this, move it into its own network layer</p>
<h2 id="We-store-FTGBaseObject-ourselves"><a href="#We-store-FTGBaseObject-ourselves" class="headerlink" title="We store FTGBaseObject ourselves"></a>We store FTGBaseObject ourselves</h2><p>Since we don’t keep PFObject around, we don’t have to store it, no need for such things as <a href="https://github.com/eladb/Parse-NSCoding" target="_blank" rel="external">PFObject+NSCoding</a></p>
<p>We can archive or save FTGBaseObject to Core Data, Mantle supports this as well.</p>
<h2 id="Parse-Local-Datastore"><a href="#Parse-Local-Datastore" class="headerlink" title="Parse Local Datastore"></a>Parse Local Datastore</h2><p>Parse just announces Local Datastore, it is great with just simple <code>pin</code> and <code>unpin</code> methods. This works well with our solution. Since we have clear separation with PFObject, we don’t care if it is from network or the local store, we just get PFObjects out and update our FTGBaseObject. FTGBaseObject is the first class citizen here</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://github.com/Mantle/Mantle" target="_blank" rel="external">Mantle</a></li>
</ol>
<ol>
<li><a href="http://stackoverflow.com/questions/14310099/abstracting-parse-objects" target="_blank" rel="external">Abstracting Parse objects?</a></li>
</ol>
<ol>
<li><a href="https://www.parse.com/questions/subclass-pfobject" target="_blank" rel="external">Subclass PFObject</a></li>
</ol>
<ol>
<li><a href="http://blog.parse.com/2014/12/09/parse-local-datastore-for-ios/" target="_blank" rel="external">Parse Local Datastore</a></li>
</ol>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.fantageek.com/blog/2014/12/19/using-parse-sdk-with-mantle/" data-title="Using Parse SDK with Mantle | Fantageek" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/blog/2015/01/12/the-importance-of-types/" title="The importance of types">
  <strong>上一篇：</strong><br/>
  <span>
  The importance of types</span>
</a>
</div>


<div class="next">
<a href="/blog/2014/12/19/conditional-objects/"  title="Conditional Objects">
 <strong>下一篇：</strong><br/> 
 <span>Conditional Objects
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Model"><span class="toc-number">1.</span> <span class="toc-text">Model</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Treat-PFObject-as-JSON-dictionary"><span class="toc-number">2.</span> <span class="toc-text">Treat PFObject as JSON dictionary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Treat-Parse-network-API-as-network-layer"><span class="toc-number">3.</span> <span class="toc-text">Treat Parse network API as network layer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#We-store-FTGBaseObject-ourselves"><span class="toc-number">4.</span> <span class="toc-text">We store FTGBaseObject ourselves</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parse-Local-Datastore"><span class="toc-number">5.</span> <span class="toc-text">Parse Local Datastore</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reference"><span class="toc-number">6.</span> <span class="toc-text">Reference</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="onmyway133" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Android/" title="Android">Android<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Script/" title="Java Script">Java Script<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Life/" title="Life">Life<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Miscellaneous/" title="Miscellaneous">Miscellaneous<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mobile-Labs/" title="Mobile Labs">Mobile Labs<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/" title="Others">Others<sup>26</sup></a></li>
		  
		
		  
			<li><a href="/categories/Programming/" title="Programming">Programming<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/Others/Windows-8/" title="Windows 8">Windows 8<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/" title="Windows 8">Windows 8<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-Phone/" title="Windows Phone">Windows Phone<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/Windows-8/Windows-Phone/" title="Windows Phone">Windows Phone<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>85</sup></a></li>
		  
		
		  
			<li><a href="/categories/programming/" title="programming">programming<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/ios/" title="ios">ios<sup>21</sup></a></li>
			
		
			
				<li><a href="/tags/wp7/" title="wp7">wp7<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/mac-osx/" title="mac osx">mac osx<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/tutorial/" title="tutorial">tutorial<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/wp8/" title="wp8">wp8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C">C<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/windows-8/" title="windows 8">windows 8<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/convert/" title="convert">convert<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/project/" title="project">project<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/disable/" title="disable">disable<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/build/" title="build">build<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/programming/" title="programming">programming<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/svn/" title="svn">svn<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/openssl/" title="openssl">openssl<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/xcode/" title="xcode">xcode<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/view-controller/" title="view controller">view controller<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/file/" title="file">file<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/facebook/" title="facebook">facebook<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/voip/" title="voip">voip<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> A dream is not a dream anymore when you don&#39;t have time for it <br/>
			What you don&#39;t know is what you haven&#39;t learned</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/onmyway133" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/1418457/onmyway133" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/onmyway133" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		
		
		
		
		
		<a href="mailto:onmyway133@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Khoa Pham">Khoa Pham</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'fantageek';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-40119591-1', 'fantageek.com');  
ga('send', 'pageview');
</script>





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
